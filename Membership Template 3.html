<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indians in Ghana - Ultimate Membership System</title>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- QR Code generation library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <!-- Barcode generation library (JsBarcode) -->
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <style>
        /* Modern Color Scheme (Combined from both templates, favoring Template 1's richness) */
        :root {
            --primary: #118AB2;       /* Ocean Blue (from Template 1) */
            --secondary: #EF476F;     /* Vibrant Pink (from Template 1) */
            --accent: #FFD166;        /* Golden Yellow (from Template 1) */
            --light: #F8F9FA;         /* Light Background (from Template 1) */
            --dark: #073B4C;          /* Dark Text / Deep Blue (from Template 1) */
            --success: #06D6A0;       /* Emerald Green (from Template 1) */
            --warning: #FFC341;       /* Brighter Yellow (from Template 1) */
            --danger: #EF476F;        /* Vibrant Pink (same as secondary in Template 1) */
            --purple: #7400b8;        /* Royal Purple (from Template 1) */
            --free: #CCCCCC;          /* Gray for Free Plan (from Template 1) */
            --basic: #A0A0A0;         /* Silver for Basic Plan (from Template 1) */
            --premium: #FFD700;       /* Gold for Premium Plan (from Template 1) */
            --font-main: 'Inter', sans-serif;
            --font-heading: 'Inter', sans-serif;
            --border-radius-card: 15px;
            --border-radius-btn: 8px;
            --box-shadow-light: 0 5px 15px rgba(0, 0, 0, 0.08);
            --box-shadow-medium: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: var(--font-main);
        }

        body {
            background-color: #f5f7fa; /* From Template 2 */
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--primary) 100%); /* From Template 2 */
            color: white;
            padding: 15px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            flex-wrap: wrap; /* Allow wrapping for responsiveness */
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo img {
            height: 50px;
            width: 50px;
            object-fit: contain;
            background: white;
            border-radius: 50%;
            padding: 5px;
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }

        /* Combined navigation styling */
        nav ul {
            display: flex;
            list-style: none;
            gap: 15px; /* Adjusted from Template 1 */
            flex-wrap: wrap;
            margin-top: 0; /* Align with header */
        }

        nav a {
            color: white; /* Changed from Template 1 to match header */
            text-decoration: none;
            font-weight: 600; /* From Template 1 */
            padding: 8px 15px;
            border-radius: var(--border-radius-btn);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        nav a:hover, nav a.active {
            background-color: rgba(255,255,255,0.15); /* From Template 2 */
            color: white;
            box-shadow: var(--box-shadow-light); /* From Template 1 */
        }

        .auth-buttons { /* From Template 1 */
            display: flex;
            gap: 10px;
        }

        .auth-btn { /* From Template 1 */
            padding: 8px 16px;
            border-radius: var(--border-radius-btn);
            background: var(--accent);
            color: var(--dark);
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: var(--box-shadow-light);
        }

        .auth-btn:hover { /* From Template 1 */
            background: #e67e22;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .page {
            display: none;
            animation: fadeIn 0.5s ease-in;
            margin-top: 30px; /* Consistent spacing */
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Card styles (from Template 1, adapted to be a base) */
        .card {
            background: rgba(255, 255, 255, 0.98);
            border-radius: var(--border-radius-card);
            padding: 25px;
            box-shadow: var(--box-shadow-medium);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--accent);
        }

        .card-title {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-icon {
            font-size: 1.8rem;
            color: var(--accent);
        }

        /* Form elements (from Template 1) */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border-radius: var(--border-radius-btn);
            border: 2px solid #e0e0e0;
            background: #ffffff;
            color: var(--dark);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(17, 138, 178, 0.2);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            height: 20px;
            width: 20px;
            border: 2px solid var(--accent);
            border-radius: 4px;
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
        }

        .checkbox-group input[type="checkbox"]:checked {
            background-color: var(--accent);
            border-color: var(--accent);
        }

        .checkbox-group input[type="checkbox"]:checked::after {
            content: '\2713';
            display: block;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--dark);
            font-size: 14px;
            font-weight: bold;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 25px;
            background-color: var(--accent);
            color: var(--dark);
            border: none;
            border-radius: var(--border-radius-btn);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            box-shadow: var(--box-shadow-light);
        }

        .btn:hover {
            background-color: #e67e22;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-block {
            display: block;
            width: 100%;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: #0c6d8c;
        }

        .btn-secondary {
            background-color: var(--secondary);
            color: white;
        }

        .btn-secondary:hover {
            background-color: #d6345f;
        }

        .btn-success {
            background-color: var(--success);
            color: white;
        }

        .btn-success:hover {
            background-color: #04b486;
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background-color: #d6345f;
        }

        .social-grid { /* From Template 1 */
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .social-item { /* From Template 1 */
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: #f0f8ff;
            border-radius: var(--border-radius-btn);
            transition: all 0.3s ease;
            cursor: pointer;
            border-left: 4px solid transparent;
            box-shadow: var(--box-shadow-light);
        }

        .social-item.verified {
            background: rgba(6, 214, 160, 0.2);
            border-left-color: var(--success);
        }

        .social-item.social-required {
            border-left-color: var(--danger);
        }

        .social-item i {
            font-size: 1.5rem;
        }

        .social-item .fa-facebook { color: #3b5998; }
        .social-item .fa-instagram { color: #e4405f; }
        .social-item .fa-youtube { color: #cd201f; }
        .social-item .fa-whatsapp { color: #25d366; }

        /* Membership Card Styles (from Template 1, adjusted slightly) */
        .membership-card {
            border-radius: var(--border-radius-card);
            padding: 20px;
            text-align: center;
            box-shadow: var(--box-shadow-medium);
            position: relative;
            overflow: hidden;
            color: var(--dark);
            max-width: 450px;
            margin: 0 auto;
            aspect-ratio: 1.6 / 1; /* Standard ID card ratio */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transition: all 0.3s ease;
            border: 3px solid rgba(255,255,255,0.7);
            background-size: cover;
            background-position: center;
        }

        /* Card Layouts */
        .layout-idcard {
            background: linear-gradient(135deg, var(--light), #e0e0e0);
        }

        .layout-passport {
            background: linear-gradient(135deg, #f8f4e5, #e8e4d5);
        }

        /* Plan-based backgrounds */
        .plan-free {
            background: linear-gradient(135deg, var(--free), #e0e0e0);
            color: var(--dark); /* Ensure text is readable on light grey */
        }

        .plan-basic {
            background: linear-gradient(135deg, var(--basic), #d0d0d0);
            color: white; /* For better contrast on silver */
        }
        .plan-basic .user-name, .plan-basic .user-id, .plan-basic .card-footer-info span {
            color: white;
        }

        .plan-premium {
            background: linear-gradient(135deg, var(--premium), #e6c200);
            color: var(--dark);
        }

        .card-logo-placeholder {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: var(--purple);
        }

        .user-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 3px solid var(--primary); /* Use primary for avatar border */
            margin: 0 auto 15px;
            background: #ffffff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            overflow: hidden;
            flex-shrink: 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-name {
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: 5px;
            color: var(--dark);
        }

        .user-id {
            font-size: 0.9rem;
            margin-bottom: 15px;
            background: rgba(0,0,0,0.05);
            padding: 5px 10px;
            border-radius: 20px;
            display: inline-block;
            color: var(--dark);
        }

        .barcode-container {
            width: 80%;
            height: 50px;
            background-color: white;
            margin: 10px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            padding: 5px;
            border-radius: 5px;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.1);
        }

        .qrcode-container {
            width: 120px;
            height: 120px;
            margin: 0 auto;
            padding: 5px;
            background: white;
            border-radius: 8px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.15);
        }

        .qrcode-logo {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 3px;
            border-radius: 3px;
            z-index: 10;
        }

        .qrcode-logo i {
            width: 35px;
            height: 35px;
            font-size: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .card-footer-info {
            margin-top: 15px;
            font-size: 0.85rem;
            color: var(--dark);
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 5px;
        }

        .card-footer-info span {
            font-weight: 500;
            background: rgba(255,255,255,0.2);
            padding: 3px 8px;
            border-radius: 5px;
        }

        /* Payment Section */
        .payment-methods { /* From Template 1 */
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .payment-method { /* From Template 1 */
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            background: var(--light);
            border-radius: var(--border-radius-btn);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            box-shadow: var(--box-shadow-light);
        }

        .payment-method.selected { /* From Template 1 */
            border-color: var(--primary);
            background: #e0f0ff;
            box-shadow: 0 5px 15px rgba(17,138,178,0.2);
        }

        .payment-method i { /* From Template 1 */
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .payment-method span { /* From Template 1 */
            font-weight: 600;
        }

        /* Admin Settings */
        .admin-settings-grid { /* From Template 1 */
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .settings-group { /* From Template 1 */
            background: var(--light);
            padding: 20px;
            border-radius: var(--border-radius-btn);
            box-shadow: var(--box-shadow-light);
        }

        .settings-group h3 { /* From Template 1 */
            margin-bottom: 15px;
            color: var(--dark);
            border-bottom: 2px solid var(--accent);
            padding-bottom: 10px;
            font-weight: 700;
        }

        .otp-container { /* From Template 1 */
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .otp-input { /* From Template 1 */
            width: 50px;
            height: 50px;
            text-align: center;
            font-size: 1.5rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .otp-input:focus { /* From Template 1 */
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(17, 138, 178, 0.2);
        }

        /* Login Screen (from Template 1, adapted to .page structure) */
        .login-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
            align-items: stretch;
        }

        .login-image-container {
            border-radius: var(--border-radius-card);
            overflow: hidden;
            box-shadow: var(--box-shadow-medium);
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f0f0f0;
            min-height: 350px;
        }

        .login-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
        }

        .login-form-container {
            padding: 25px;
            border-radius: var(--border-radius-card);
            background: rgba(255, 255, 255, 0.98);
            box-shadow: var(--box-shadow-medium);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .business-grid { /* From Template 1 */
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .business-item { /* From Template 1 */
            background: white;
            border-radius: var(--border-radius-btn);
            padding: 15px;
            text-align: center;
            box-shadow: var(--box-shadow-light);
            transition: all 0.3s ease;
        }

        .business-item:hover { /* From Template 1 */
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .business-logo { /* From Template 1 */
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin: 0 auto 10px;
            background: #f0f8ff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--primary);
            overflow: hidden;
        }

        .business-logo img { /* From Template 1 */
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .sector-title { /* From Template 1 */
            margin-top: 30px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--accent);
            color: var(--dark);
            font-weight: 600;
        }

        .stats-container { /* From Template 1 */
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card { /* From Template 1 */
            background: white;
            border-radius: var(--border-radius-btn);
            padding: 20px;
            text-align: center;
            box-shadow: var(--box-shadow-light);
        }

        .stat-value { /* From Template 1 */
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin: 10px 0;
        }

        .stat-label { /* From Template 1 */
            font-size: 1rem;
            color: var(--dark);
        }

        .terms-container { /* From Template 1 */
            max-height: 300px;
            overflow-y: auto;
            padding: 15px;
            background: #f8f9fa;
            border-radius: var(--border-radius-btn);
            margin: 20px 0;
            border: 1px solid #eee;
        }

        .deals-tabs { /* From Template 1 */
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .deals-tab { /* From Template 1 */
            padding: 10px 20px;
            background: #f0f0f0;
            border-radius: var(--border-radius-btn);
            cursor: pointer;
            transition: all 0.3s ease;
            flex-grow: 1;
            text-align: center;
        }

        .deals-tab.active { /* From Template 1 */
            background: var(--primary);
            color: white;
        }

        .deal-actions { /* From Template 1 */
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .used-btn { /* From Template 1 */
            background-color: var(--success);
            color: white;
            border: none;
            border-radius: var(--border-radius-btn);
            padding: 8px 15px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.3s ease;
        }

        .used-btn:hover { /* From Template 1 */
            background-color: #04b486;
        }

        .login-links { /* From Template 1 */
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }

        /* Admin/Merchant Deals Stats Grid */
        .deal-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .deal-stat-card {
            background: white;
            border-radius: var(--border-radius-btn);
            padding: 15px;
            text-align: center;
            box-shadow: var(--box-shadow-light);
        }

        .deal-stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--secondary);
            margin-bottom: 5px;
        }

        .deal-stat-label {
            font-size: 0.9rem;
            color: var(--gray);
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 20px;
            margin-top: 40px;
            background-color: var(--dark); /* From Template 1 */
            color: white;
            border-radius: var(--border-radius-card); /* From Template 1 */
            box-shadow: var(--box-shadow-medium); /* From Template 1 */
        }

        footer p {
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        /* Custom Notification Element (from Template 1) */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--success);
            color: white;
            padding: 15px 20px;
            border-radius: var(--border-radius-btn);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 10px;
            opacity: 0;
            transform: translateY(100%);
            transition: all 0.4s ease-out;
            z-index: 1000;
        }

        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }

        .notification.error {
            background-color: var(--danger);
        }

        .notification.info {
            background-color: var(--primary);
        }

        /* Custom Confirmation Modal */
        #custom-confirm-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        #custom-confirm-modal .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            max-width: 400px;
            text-align: center;
        }

        #custom-confirm-modal .modal-content p {
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        #custom-confirm-modal .modal-content button {
            margin: 0 5px;
        }

        /* Responsive adjustments */
        @media (max-width: 992px) {
            .login-container {
                grid-template-columns: 1fr;
            }
            .login-image-container {
                height: 200px;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            nav ul {
                justify-content: center;
                margin-top: 10px; /* Space from logo */
            }
            .auth-buttons {
                width: 100%;
                justify-content: center;
            }
            .main-content {
                flex-direction: column;
            }
            .admin-settings-grid {
                grid-template-columns: 1fr;
            }
            .card-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            .card-title {
                text-align: left;
            }
            .otp-container {
                flex-wrap: wrap;
            }
            .membership-card {
                aspect-ratio: 1 / 1.6;
                flex-direction: column;
                justify-content: center;
            }
            .user-avatar {
                margin-bottom: 10px;
            }
            .card-footer-info {
                flex-direction: column;
                align-items: center;
            }
            .deals-tab {
                flex-basis: 100%;
            }
            .deal-actions {
                flex-direction: column;
            }
        }

        @media (max-width: 480px) {
            .auth-form-container {
                padding: 20px;
            }
            .stats-grid, .deal-stats-grid {
                grid-template-columns: 1fr;
            }
            .social-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/41/Flag_of_India.svg/1200px-Flag_of_India.svg.png" alt="India Flag">
                <h1>Indians in Ghana</h1>
            </div>
            <nav>
                <ul>
                    <li><a href="#" class="nav-link active" data-page="home">Home</a></li>
                    <li><a href="#" class="nav-link" data-page="membership">Membership Card</a></li>
                    <li><a href="#" class="nav-link" data-page="deals">Exclusive Deals</a></li>
                    <li id="merchant-nav-item" style="display: none;"><a href="#" class="nav-link" data-page="merchant">Merchant Panel</a></li>
                    <li id="admin-nav-item" style="display: none;"><a href="#" class="nav-link" data-page="admin">Admin Panel</a></li>
                    <li><a href="#" class="nav-link" data-page="settings">User Settings</a></li>
                    <li><a href="#" class="nav-link" data-page="about">About Us</a></li>
                    <li><a href="#" class="nav-link" data-page="contact">Contact Us</a></li>
                </ul>
            </nav>
            <div class="auth-buttons">
                <div class="auth-btn" id="login-btn">
                    <i class="fas fa-sign-in-alt"></i> Login
                </div>
                <div class="auth-btn" id="logout-btn" style="display: none;">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Home Page (Login/Registration) -->
        <div id="home-page" class="page active">
            <div class="card active-section" id="login-section">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-sign-in-alt"></i> Login to Your Account</h2>
                    <div class="card-icon">
                        <i class="fas fa-user-circle"></i>
                    </div>
                </div>

                <div class="login-container">
                    <div class="login-image-container">
                        <img id="login-image" src="https://images.unsplash.com/photo-1552664730-d307ca884978?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80" alt="Login Image" class="login-image" onerror="this.onerror=null;this.src='https://placehold.co/600x400/CCCCCC/333333?text=Login+Image';">
                    </div>

                    <div class="login-form-container">
                        <div class="tabs" style="margin-bottom: 20px; display: flex; justify-content: center; gap: 15px;">
                            <div class="btn btn-primary active" data-tab="user-phone" style="flex: 1;">User Phone Login</div>
                            <div class="btn btn-secondary" data-tab="user-email" style="flex: 1;">User Email Login</div>
                            <div class="btn btn-secondary" data-tab="merchant-login" style="flex: 1;">Merchant Login</div>
                        </div>

                        <!-- User Phone Login Content -->
                        <div class="tab-content active" id="user-phone-tab">
                            <form id="user-phone-login-form">
                                <div class="form-group">
                                    <label for="user-phone">Phone Number</label>
                                    <input type="tel" id="user-phone" placeholder="e.g., +233 24 123 4567" required>
                                </div>

                                <button type="button" class="btn btn-primary btn-block" id="send-user-otp"><i class="fas fa-sms"></i> Send OTP</button>

                                <div class="form-group" id="user-otp-section" style="display: none; margin-top: 20px;">
                                    <label>Enter OTP</label>
                                    <div class="otp-container">
                                        <input type="text" class="otp-input" maxlength="1" pattern="[0-9]" inputmode="numeric" required>
                                        <input type="text" class="otp-input" maxlength="1" pattern="[0-9]" inputmode="numeric" required>
                                        <input type="text" class="otp-input" maxlength="1" pattern="[0-9]" inputmode="numeric" required>
                                        <input type="text" class="otp-input" maxlength="1" pattern="[0-9]" inputmode="numeric" required>
                                        <input type="text" class="otp-input" maxlength="1" pattern="[0-9]" inputmode="numeric" required>
                                        <input type="text" class="otp-input" maxlength="1" pattern="[0-9]" inputmode="numeric" required>
                                    </div>
                                    <button type="button" class="btn btn-success btn-block" id="user-login-verify-otp"><i class="fas fa-check-circle"></i> Login</button>
                                </div>
                            </form>
                        </div>

                        <!-- User Email Login Content -->
                        <div class="tab-content" id="user-email-tab" style="display: none;">
                            <form id="email-login-form">
                                <div class="form-group">
                                    <label for="email">Email Address</label>
                                    <input type="email" id="email" placeholder="Enter your email" required>
                                </div>

                                <div class="form-group">
                                    <label for="password">Password</label>
                                    <input type="password" id="password" placeholder="Enter password" required>
                                </div>

                                <div class="login-links">
                                    <a href="#" id="forgot-password" style="color: var(--primary);">Forgot Password?</a>
                                    <a href="#" id="show-register" style="color: var(--primary);">Register Now</a>
                                </div>

                                <button type="submit" class="btn btn-primary btn-block" style="margin-top: 15px;"><i class="fas fa-sign-in-alt"></i> Login</button>
                            </form>
                        </div>

                        <!-- Merchant Login Content -->
                        <div class="tab-content" id="merchant-login-tab" style="display: none;">
                            <form id="merchant-login-form">
                                <div class="form-group">
                                    <label for="merchant-email">Merchant Email Address</label>
                                    <input type="email" id="merchant-email" placeholder="Enter merchant email" required>
                                </div>

                                <div class="form-group">
                                    <label for="merchant-password">Password</label>
                                    <input type="password" id="merchant-password" placeholder="Enter password" required>
                                </div>

                                <button type="submit" class="btn btn-primary btn-block" style="margin-top: 15px;"><i class="fas fa-sign-in-alt"></i> Merchant Login</button>
                                <div class="form-footer" style="margin-top: 15px;">
                                    <a href="#" id="show-merchant-register">Register as a Merchant</a>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Business Sectors and Businesses -->
                <h3 class="sector-title"><i class="fas fa-briefcase"></i> Our Business Partners</h3>
                <div id="business-sectors-container">
                    <!-- Sectors and businesses will be dynamically loaded here -->
                </div>

                <!-- Terms and Conditions -->
                <h3 class="sector-title"><i class="fas fa-file-alt"></i> Terms and Conditions</h3>
                <div class="terms-container" id="terms-container">
                    <!-- Terms will be loaded dynamically -->
                </div>

                <!-- Statistics -->
                <h3 class="sector-title"><i class="fas fa-chart-bar"></i> Community Statistics</h3>
                <div class="stats-container" id="stats-container">
                    <!-- Stats will be loaded dynamically -->
                </div>
            </div>
        </div>

        <!-- Registration Section -->
        <div id="registration-page" class="page">
            <div class="card user-panel" id="registration-section">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-user-plus"></i> Membership Registration</h2>
                    <div class="card-icon">
                        <i class="fas fa-id-card"></i>
                    </div>
                </div>
                <p style="margin-bottom: 20px;">Join our growing community of members to access exclusive benefits and connect with fellow Indians in Ghana.</p>

                <p style="margin-bottom: 15px; text-align: center;">
                    <a href="https://indiansinghana.com/registration/" target="_blank" style="color: var(--primary); font-weight: bold;">
                        <i class="fas fa-external-link-alt"></i> Register on our website
                    </a>
                </p>

                <form id="registration-form">
                    <div class="form-group">
                        <label for="full-name">Full Name</label>
                        <input type="text" id="full-name" placeholder="Enter your full name" required>
                    </div>

                    <div class="form-group">
                        <label for="reg-email">Email Address</label>
                        <input type="email" id="reg-email" placeholder="Enter your email address" required>
                    </div>

                    <div class="form-group">
                        <label for="reg-password">Create Password</label>
                        <input type="password" id="reg-password" placeholder="Create a password" required>
                    </div>

                    <div class="form-group">
                        <label for="reg-phone">Mobile Number (Ghana)</label>
                        <input type="tel" id="reg-phone" placeholder="e.g., +233 24 123 4567" required>
                        <button type="button" class="btn btn-secondary" id="send-reg-otp" style="margin-top: 10px; width: 100%;">
                            <i class="fas fa-sms"></i> Send OTP to Mobile
                        </button>
                    </div>

                    <div class="form-group" id="reg-otp-section" style="display: none;">
                        <label>Enter Mobile OTP</label>
                        <div class="otp-container">
                            <input type="text" class="reg-otp-input" maxlength="1" pattern="[0-9]" inputmode="numeric" required>
                            <input type="text" class="reg-otp-input" maxlength="1" pattern="[0-9]" inputmode="numeric" required>
                            <input type="text" class="reg-otp-input" maxlength="1" pattern="[0-9]" inputmode="numeric" required>
                            <input type="text" class="reg-otp-input" maxlength="1" pattern="[0-9]" inputmode="numeric" required>
                            <input type="text" class="reg-otp-input" maxlength="1" pattern="[0-9]" inputmode="numeric" required>
                            <input type="text" class="reg-otp-input" maxlength="1" pattern="[0-9]" inputmode="numeric" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="reg-address">Ghana Address</label>
                        <input type="text" id="reg-address" placeholder="Enter your full address in Ghana" required>
                    </div>

                    <div class="form-group">
                        <label for="profile-photo">Profile Photo</label>
                        <input type="file" id="profile-photo" accept="image/*">
                        <small style="color: #666;">Max 2MB. Face clearly visible.</small>
                    </div>

                    <h3 class="card-title" style="margin-top: 30px;"><i class="fas fa-share-alt"></i> Connect With Us</h3>
                    <p style="margin-bottom: 15px;">Follow our social media channels to complete your registration requirements:</p>

                    <div class="social-grid" id="registration-social-grid">
                        <!-- Social items will be dynamically loaded here -->
                    </div>

                    <h3 class="card-title" style="margin-top: 30px;" id="plan-selection-title"><i class="fas fa-crown"></i> Select Membership Plan</h3>
                    <div class="form-group" id="plan-selection-container">
                        <label for="selected-plan">Choose Your Plan</label>
                        <select id="selected-plan" class="form-control">
                            <!-- Plans will be dynamically loaded here -->
                        </select>
                    </div>

                    <p style="margin-top: 10px; font-size: 0.9em; color: #555;">
                        <i class="fas fa-info-circle"></i> Once registered, your membership card will be activated by admin within 24 hours.
                    </p>

                    <button type="submit" class="btn btn-success btn-block" style="margin-top: 25px;"><i class="fas fa-check-circle"></i> Complete Registration</button>
                </form>
            </div>
        </div>

        <!-- Merchant Registration Section -->
        <div id="merchant-registration-page" class="page">
            <div class="card merchant-panel">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-store"></i> Merchant Registration</h2>
                    <div class="card-icon">
                        <i class="fas fa-handshake"></i>
                    </div>
                </div>
                <p style="margin-bottom: 20px;">Join our platform to offer exclusive deals to our community and grow your business!</p>

                <form id="merchant-registration-form">
                    <div class="form-group">
                        <label for="merchant-name">Business Name</label>
                        <input type="text" id="merchant-name" placeholder="Your business name" required>
                    </div>
                    <div class="form-group">
                        <label for="merchant-reg-email">Business Email</label>
                        <input type="email" id="merchant-reg-email" placeholder="Business contact email" required>
                    </div>
                    <div class="form-group">
                        <label for="merchant-reg-password">Create Password</label>
                        <input type="password" id="merchant-reg-password" placeholder="Create a password" required>
                    </div>
                    <div class="form-group">
                        <label for="merchant-phone">Contact Phone</label>
                        <input type="tel" id="merchant-phone" placeholder="e.g., +233 24 123 4567" required>
                    </div>
                    <div class="form-group">
                        <label for="merchant-address">Business Address</label>
                        <textarea id="merchant-address" rows="3" placeholder="Full business address" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="merchant-category">Business Category</label>
                        <select id="merchant-category" class="form-control" required>
                            <option value="">Select a category</option>
                            <option value="Restaurants">Restaurants</option>
                            <option value="Retail">Retail</option>
                            <option value="Services">Services</option>
                            <option value="Travel">Travel</option>
                            <option value="Health">Health</option>
                            <option value="Education">Education</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="merchant-logo-url">Business Logo URL (Optional)</label>
                        <input type="text" id="merchant-logo-url" placeholder="URL to your business logo">
                    </div>
                    <button type="submit" class="btn btn-success btn-block"><i class="fas fa-user-plus"></i> Register Merchant Account</button>
                    <div class="form-footer" style="margin-top: 15px;">
                        <p>Already have a merchant account? <a href="#" id="switchToMerchantLogin">Login Now</a></p>
                    </div>
                </form>
            </div>
        </div>

        <!-- Membership Card Section -->
        <div id="membership-page" class="page">
            <div class="card user-panel" id="membership-section">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-id-card-alt"></i> Your Digital Membership Card</h2>
                    <div class="card-icon">
                        <i class="fas fa-star"></i>
                    </div>
                </div>

                <div class="membership-card" id="membership-card-display">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <span style="font-size: 1.2rem; font-weight: bold; color: inherit;">Indians in Ghana</span>
                        <span style="background: var(--primary); color: white; padding: 5px 10px; border-radius: 10px; font-weight: 600;" id="card-plan-name-badge">Gold Plan</span>
                    </div>

                    <div class="user-avatar" id="card-avatar">
                        <i class="fas fa-user"></i>
                        <!-- User photo will be dynamically loaded here -->
                    </div>

                    <div class="user-name" id="card-name">Rajesh Kumar</div>
                    <div class="user-id" id="card-unique-number">GH-IN-2025-1234</div>

                    <div class="barcode-container">
                        <canvas id="barcode-display"></canvas>
                    </div>

                    <div class="qrcode-container">
                        <canvas id="qrcode-display"></canvas>
                        <div class="qrcode-logo">
                            <i class="fas fa-users" style="color: var(--dark);"></i>
                        </div>
                    </div>

                    <div class="card-footer-info">
                        <span>Plan: <strong id="card-plan-footer">Gold Membership</strong></span>
                        <span>Expiry: <strong id="card-expiry-footer">Dec 31, 2025</strong></span>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <p style="margin-bottom: 15px; color: #555;">Present this card for exclusive deals & event access.</p>
                    <button class="btn btn-primary" style="margin-right: 10px;" id="download-card-btn"><i class="fas fa-download"></i> Download Card</button>
                    <button class="btn btn-secondary" id="share-card-btn"><i class="fab fa-whatsapp"></i> Share via WhatsApp</button>
                </div>

                <div class="instructions" style="margin-top: 40px;">
                    <h3 class="card-title"><i class="fas fa-info-circle"></i> How to Use Your Card</h3>
                    <ol>
                        <li>Your unique QR code & barcode identify you as a verified member.</li>
                        <li>Present this digital card at partner businesses to access exclusive deals.</li>
                        <li>Your membership ID is required for event registrations and priority services.</li>
                        <li>You can download the card as an image or share it directly.</li>
                    </ol>
                </div>
            </div>

            <!-- Payment Section (Shown after registration for non-free plans) -->
            <div class="card user-panel" id="payment-section" style="display: none;">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-credit-card"></i> Complete Your Membership Payment</h2>
                    <div class="card-icon">
                        <i class="fas fa-wallet"></i>
                    </div>
                </div>

                <div class="form-group">
                    <label>Selected Plan: <strong id="payment-plan-name"></strong></label>
                    <p style="font-size: 1.2rem; font-weight: bold; color: var(--dark);">Amount Due: <span id="payment-amount"></span></p>
                </div>

                <div class="form-group">
                    <label>Select Payment Method</label>
                    <div class="payment-methods">
                        <div class="payment-method" data-method="momo">
                            <i class="fas fa-mobile-alt"></i>
                            <span>Mobile Money</span>
                        </div>
                        <div class="payment-method" data-method="cash">
                            <i class="fas fa-money-bill-wave"></i>
                            <span>Cash Payment</span>
                        </div>
                        <div class="payment-method" data-method="bank">
                            <i class="fas fa-university"></i>
                            <span>Bank Transfer</span>
                        </div>
                    </div>
                </div>

                <div class="form-group" id="momo-details" style="display: none;">
                    <label for="momo-number">Mobile Money Number</label>
                    <input type="tel" id="momo-number" placeholder="Enter your MoMo number">

                    <label for="momo-name">Name on Account</label>
                    <input type="text" id="momo-name" placeholder="Enter account holder name">
                    <small style="color: #666;">An OTP will be sent to your MoMo number for confirmation.</small>
                </div>

                <div class="form-group" id="cash-details" style="display: none;">
                    <p style="font-weight: 500;">Please visit our office to complete your payment:</p>
                    <p><strong>Indians in Ghana Office</strong><br>
                        123 Community Street, Accra, Ghana<br>
                        Open: Mon-Fri, 9am-5pm</p>
                    <p style="margin-top: 10px; color: var(--danger); font-weight: bold;"><i class="fas fa-exclamation-triangle"></i> Remember to collect a receipt!</p>
                </div>

                <div class="form-group" id="bank-details" style="display: none;">
                    <p style="font-weight: 500;">Please transfer funds to the following bank account:</p>
                    <p><strong>Bank: Ghana Commercial Bank</strong><br>
                        <strong>Account Number: 1234567890</strong><br>
                        <strong>Account Name: Indians in Ghana Community</strong><br>
                        <strong>Reference: Your Phone Number (e.g., +233 55 123 4567)</strong></p>
                    <p style="margin-top: 10px; color: var(--primary); font-weight: bold;"><i class="fas fa-lightbulb"></i> Please allow 1-2 business days for transfer confirmation.</p>
                </div>

                <button class="btn btn-success btn-block" id="complete-payment-btn"><i class="fas fa-check-circle"></i> Confirm Payment</button>
            </div>
        </div>

        <!-- Exclusive Deals Section -->
        <div id="deals-page" class="page">
            <div class="card user-panel" id="deals-section">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-tags"></i> Exclusive Member Deals</h2>
                    <div class="card-icon">
                        <i class="fas fa-gift"></i>
                    </div>
                </div>

                <p style="margin-bottom: 20px;">As a valued member, enjoy special discounts and offers from our partners across Ghana!</p>

                <div class="deals-tabs">
                    <div class="deals-tab active" data-deal-filter="current">Current Deals</div>
                    <div class="deals-tab" data-deal-filter="past">Past Deals</div>
                    <div class="deals-tab" data-deal-filter="upcoming">Upcoming Deals</div>
                </div>

                <div id="deals-list" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">
                    <!-- Deal items will be populated here -->
                </div>
                <p style="margin-top: 30px; text-align: center; color: #777;"><i class="fas fa-handshake"></i> More exciting deals added weekly!</p>
            </div>
        </div>

        <!-- Merchant Panel Section -->
        <div id="merchant-page" class="page">
            <div class="card merchant-panel">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-store"></i> Merchant Panel</h2>
                    <div class="card-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                </div>

                <div class="tabs" style="margin-bottom: 20px; display: flex; justify-content: center; gap: 15px;">
                    <div class="btn btn-primary active" data-tab="merchant-deals-management" style="flex: 1;">Manage My Deals</div>
                    <div class="btn btn-secondary" data-tab="merchant-stats" style="flex: 1;">Deal Statistics</div>
                </div>

                <!-- Merchant Deals Management Tab -->
                <div class="tab-content active" id="merchant-deals-management-tab">
                    <h3 class="card-title"><i class="fas fa-handshake"></i> My Deals</h3>
                    <p style="margin-bottom: 20px;">Add new deals or manage your existing offers.</p>

                    <button class="btn btn-primary" id="add-new-merchant-deal-btn" style="margin-bottom: 20px;"><i class="fas fa-plus-circle"></i> Add New Deal</button>

                    <div id="merchant-deal-management-list" style="max-height: 400px; overflow-y: auto; border: 1px solid #eee; border-radius: 8px; padding: 10px;">
                        <!-- Merchant's deal items will be dynamically populated here -->
                    </div>

                    <!-- Add/Edit Merchant Deal Form (Hidden by default) -->
                    <div class="card" id="add-edit-merchant-deal-form" style="display: none; margin-top: 20px;">
                        <h3 class="card-title" id="merchant-deal-form-title"><i class="fas fa-edit"></i> Add/Edit Deal</h3>
                        <form>
                            <div class="form-group">
                                <label for="merchant-deal-title">Deal Title</label>
                                <input type="text" id="merchant-deal-title" placeholder="e.g., 20% Off Restaurant Bill" required>
                            </div>
                            <div class="form-group">
                                <label for="merchant-deal-description">Description</label>
                                <textarea id="merchant-deal-description" rows="3" placeholder="Brief description of the deal, terms, etc." required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="merchant-deal-category">Category</label>
                                <select id="merchant-deal-category" class="form-control" required>
                                    <option value="">Select category</option>
                                    <option value="Food">Food</option>
                                    <option value="Retail">Retail</option>
                                    <option value="Travel">Travel</option>
                                    <option value="Services">Services</option>
                                    <option value="Health">Health</option>
                                    <option value="Education">Education</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="merchant-deal-applicable-plans">Applicable Plans (select all that apply)</label>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="merchant-deal-plan-free">
                                    <label for="merchant-deal-plan-free">Community Plan</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="merchant-deal-plan-basic">
                                    <label for="merchant-deal-plan-basic">Silver Plan</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="merchant-deal-plan-premium">
                                    <label for="merchant-deal-plan-premium">Gold Plan</label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="merchant-deal-expiry-date">Expiry Date</label>
                                <input type="date" id="merchant-deal-expiry-date" required>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="merchant-deal-active" checked>
                                <label for="merchant-deal-active">Deal Active</label>
                            </div>
                            <button type="submit" class="btn btn-success" id="save-merchant-deal-btn" style="margin-top: 15px;"><i class="fas fa-save"></i> Save Deal</button>
                            <button type="button" class="btn btn-secondary" id="cancel-merchant-deal-btn" style="margin-left: 10px;"><i class="fas fa-times"></i> Cancel</button>
                        </form>
                    </div>
                </div>

                <!-- Merchant Deal Statistics Tab -->
                <div class="tab-content" id="merchant-stats-tab" style="display: none;">
                    <h3 class="card-title"><i class="fas fa-chart-bar"></i> Your Deal Statistics</h3>
                    <p style="margin-bottom: 20px;">Monitor the performance of your deals.</p>

                    <div id="merchant-deals-stats-list">
                        <!-- Deal-specific statistics will be populated here -->
                    </div>

                    <div class="deal-stats-grid" style="margin-top: 30px;">
                        <div class="deal-stat-card">
                            <div class="deal-stat-value" id="total-deals-offered">0</div>
                            <div class="deal-stat-label">Total Deals Offered</div>
                        </div>
                        <div class="deal-stat-card">
                            <div class="deal-stat-value" id="total-deal-redemptions">0</div>
                            <div class="deal-stat-label">Total Redemptions</div>
                        </div>
                        <div class="deal-stat-card">
                            <div class="deal-stat-value" id="average-redemptions">0</div>
                            <div class="deal-stat-label">Avg. Redemptions per Deal</div>
                        </div>
                        <div class="deal-stat-card">
                            <div class="deal-stat-value" id="active-deals-count">0</div>
                            <div class="deal-stat-label">Active Deals</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- User Settings Section -->
        <div id="settings-page" class="page">
            <div class="card user-panel" id="settings-section">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-cog"></i> Your Account Settings</h2>
                    <div class="card-icon">
                        <i class="fas fa-user-edit"></i>
                    </div>
                </div>

                <form id="user-settings-form">
                    <div class="form-group">
                        <label for="setting-full-name">Full Name</label>
                        <input type="text" id="setting-full-name">
                    </div>
                    <div class="form-group">
                        <label for="setting-phone">Mobile Number</label>
                        <input type="tel" id="setting-phone" disabled>
                        <small style="color: #666;">Contact admin to change phone number.</small>
                    </div>
                    <div class="form-group">
                        <label for="setting-email">Email Address</label>
                        <input type="email" id="setting-email">
                    </div>
                    <div class="form-group">
                        <label for="setting-address">Ghana Address</label>
                        <input type="text" id="setting-address">
                    </div>
                    <div class="form-group">
                        <label for="setting-profile-photo">Update Profile Photo</label>
                        <input type="file" id="setting-profile-photo" accept="image/*">
                    </div>

                    <h3 class="card-title" style="margin-top: 30px;"><i class="fas fa-lock"></i> Password Management</h3>
                    <div class="form-group">
                        <label for="current-password">Current Password</label>
                        <input type="password" id="current-password" placeholder="Enter current password">
                    </div>
                    <div class="form-group">
                        <label for="new-password">New Password</label>
                        <input type="password" id="new-password" placeholder="Enter new password">
                    </div>
                    <div class="form-group">
                        <label for="confirm-password">Confirm New Password</label>
                        <input type="password" id="confirm-password" placeholder="Confirm new password">
                    </div>

                    <button type="submit" class="btn btn-primary btn-block" id="save-user-settings"><i class="fas fa-save"></i> Save Settings</button>
                    <button type="button" class="btn btn-danger btn-block" style="margin-top: 15px;" id="delete-account-btn"><i class="fas fa-trash-alt"></i> Delete Account</button>
                </form>
            </div>
        </div>

        <!-- Admin Panel Section -->
        <div id="admin-page" class="page">
            <div class="card admin-panel" id="admin-section">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-tools"></i> Admin Control Panel</h2>
                    <div class="card-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                </div>

                <div class="tabs" style="margin-bottom: 20px; display: flex; justify-content: center; gap: 15px;">
                    <div class="btn btn-primary active" data-tab="admin-settings" style="flex: 1;">System Settings</div>
                    <div class="btn btn-secondary" data-tab="member-management" style="flex: 1;">Member Management</div>
                    <div class="btn btn-secondary" data-tab="deal-management" style="flex: 1;">Deal Management</div>
                    <div class="btn btn-secondary" data-tab="business-management" style="flex: 1;">Business Management</div>
                    <div class="btn btn-secondary" data-tab="merchant-management" style="flex: 1;">Merchant Management</div>
                </div>

                <!-- Admin System Settings Tab -->
                <div class="tab-content active" id="admin-settings-tab">
                    <div class="admin-settings-grid">
                        <!-- Social Media Settings -->
                        <div class="settings-group">
                            <h3>Social Media Requirements</h3>
                            <p style="font-size: 0.9em; color: #666; margin-bottom: 15px;">Control which social media follows are required for registration and set links.</p>

                            <div class="form-group">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="req-facebook" checked>
                                    <label for="req-facebook">Require Facebook Follow</label>
                                </div>
                                <input type="text" id="facebook-link" value="https://www.facebook.com/indiansinghana" placeholder="Facebook Link">
                            </div>

                            <div class="form-group">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="req-instagram" checked>
                                    <label for="req-instagram">Require Instagram Follow</label>
                                </div>
                                <input type="text" id="instagram-link" value="https://instagram.com/indians_in_ghana" placeholder="Instagram Link">
                            </div>

                            <div class="form-group">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="req-youtube">
                                    <label for="req-youtube">Require YouTube Subscribe</label>
                                </div>
                                <input type="text" id="youtube-link" value="https://youtube.com/indiansinghana" placeholder="YouTube Link">
                            </div>

                            <div class="form-group">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="req-whatsapp-channel" checked>
                                    <label for="req-whatsapp-channel">Require WhatsApp Channel Join</label>
                                </div>
                                <input type="text" id="whatsapp-channel-link" value="https://whatsapp.com/channel/indiansinghana" placeholder="WhatsApp Channel Link">
                            </div>

                            <div class="form-group">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="req-whatsapp-group" checked>
                                    <label for="req-whatsapp-group">Require WhatsApp Group Join</label>
                                </div>
                                <input type="text" id="whatsapp-group-link" value="https://chat.whatsapp.com/indiansinghana" placeholder="WhatsApp Group Link">
                            </div>
                        </div>

                        <!-- Membership Plan Settings -->
                        <div class="settings-group">
                            <h3>Membership Plan Configuration</h3>
                            <p style="font-size: 0.9em; color: #666; margin-bottom: 15px;">Define your membership plans, prices, and features.</p>

                            <div class="checkbox-group">
                                <input type="checkbox" id="show-plan-selection" checked>
                                <label for="show-plan-selection">Enable Plan Selection during Registration</label>
                            </div>

                            <div class="form-group">
                                <label for="card-layout-select">Default Card Layout</label>
                                <select id="card-layout-select" class="form-control">
                                    <option value="idcard">ID Card Style</option>
                                    <option value="passport">Passport Style</option>
                                </select>
                            </div>

                            <h4 style="margin-top: 25px; margin-bottom: 15px; color: var(--primary);">Manage Plans</h4>

                            <div class="form-group">
                                <label for="free-plan-name">Free Plan Name</label>
                                <input type="text" id="free-plan-name" value="Community Plan">

                                <label for="free-plan-price">Price</label>
                                <input type="text" id="free-plan-price" value="FREE" disabled>

                                <label for="free-plan-features">Features (one per line, comma-separated)</label>
                                <textarea id="free-plan-features" rows="4">Basic digital card,Limited deal access,Community updates,Valid for 1 year</textarea>
                            </div>

                            <div class="form-group">
                                <label for="basic-plan-name">Silver Plan Name</label>
                                <input type="text" id="basic-plan-name" value="Silver Plan">

                                <label for="basic-plan-price">Silver Plan Price (₵)</label>
                                <input type="number" id="basic-plan-price" value="150" min="0">

                                <label for="basic-plan-features">Features (one per line, comma-separated)</label>
                                <textarea id="basic-plan-features" rows="4">Enhanced digital card,Access to all deals (5-15% discounts),Priority email support,Event invitations,Valid for 1 year</textarea>
                            </div>

                            <div class="form-group">
                                <label for="premium-plan-name">Gold Plan Name</label>
                                <input type="text" id="premium-plan-name" value="Gold Plan">

                                <label for="premium-plan-price">Gold Plan Price (₵)</label>
                                <input type="number" id="premium-plan-price" value="300" min="0">

                                <label for="premium-plan-features">Features (one per line, comma-separated)</label>
                                <textarea id="premium-plan-features" rows="4">Premium digital card,VIP access to all deals (15-30% discounts),24/7 dedicated support,Exclusive event access,Free partner services offers,Valid for 1 year</textarea>
                            </div>
                        </div>

                        <!-- System Settings -->
                        <div class="settings-group">
                            <h3>General System Settings</h3>
                            <p style="font-size: 0.9em; color: #666; margin-bottom: 15px;">Configure core application behavior.</p>

                            <div class="form-group">
                                <label for="system-name">System Name</label>
                                <input type="text" id="system-name" value="Indians in Ghana Membership">
                            </div>

                            <div class="form-group">
                                <label for="admin-notification-email">Admin Notification Email</label>
                                <input type="email" id="admin-notification-email" value="admin@indiansinghana.com">
                            </div>

                            <div class="form-group">
                                <label for="card-expiry-period">Default Card Expiry Period</label>
                                <select id="card-expiry-period" class="form-control">
                                    <option value="365">1 Year</option>
                                    <option value="730">2 Years</option>
                                    <option value="1095">3 Years</option>
                                </select>
                            </div>

                            <div class="checkbox-group">
                                <input type="checkbox" id="auto-approve-free" checked>
                                <label for="auto-approve-free">Auto-approve Free Plan Registrations</label>
                            </div>

                            <div class="form-group">
                                <label for="login-image-url">Login Page Image URL</label>
                                <input type="text" id="login-image-url" placeholder="Enter image URL">
                                <small>Upload an image and enter URL here</small>
                            </div>

                            <div class="form-group">
                                <label for="terms-conditions">Terms and Conditions</label>
                                <textarea id="terms-conditions" rows="5" placeholder="Enter terms and conditions">By using this service, you agree to abide by all rules and regulations set forth by the Indians in Ghana community. Membership benefits are subject to change without prior notice. All disputes are subject to Ghanaian jurisdiction.</textarea>
                            </div>

                            <div class="checkbox-group">
                                <input type="checkbox" id="show-stats" checked>
                                <label for="show-stats">Show Statistics on Login Page</label>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: 30px; text-align: center;">
                        <button class="btn btn-success" id="save-admin-settings"><i class="fas fa-save"></i> Save All Settings</button>
                    </div>
                </div>

                <!-- Member Management Tab -->
                <div class="tab-content" id="member-management-tab" style="display: none;">
                    <h3 class="card-title"><i class="fas fa-users"></i> Manage Members</h3>
                    <p style="margin-bottom: 20px;">View, approve, edit, or delete member accounts.</p>

                    <div class="form-group">
                        <input type="text" id="member-search" placeholder="Search by Name, ID, or Phone">
                        <button class="btn btn-primary" style="margin-top: 10px;"><i class="fas fa-search"></i> Search</button>
                    </div>

                    <div id="member-list" style="max-height: 400px; overflow-y: auto; border: 1px solid #eee; border-radius: 8px; padding: 10px;">
                        <!-- Member items will be dynamically populated here -->
                    </div>
                </div>

                <!-- Deal Management Tab -->
                <div class="tab-content" id="deal-management-tab" style="display: none;">
                    <h3 class="card-title"><i class="fas fa-handshake"></i> Manage Deals & Partners (Admin View)</h3>
                    <p style="margin-bottom: 20px;">Add, edit, or remove exclusive deals for members across all partners.</p>

                    <button class="btn btn-primary" id="admin-add-new-deal-btn" style="margin-bottom: 20px;"><i class="fas fa-plus-circle"></i> Add New Deal</button>

                    <div id="admin-deal-management-list" style="max-height: 400px; overflow-y: auto; border: 1px solid #eee; border-radius: 8px; padding: 10px;">
                        <!-- Deal management items will be dynamically populated here -->
                    </div>

                    <!-- Add/Edit Deal Form (Hidden by default) -->
                    <div class="card" id="admin-add-edit-deal-form" style="display: none; margin-top: 20px;">
                        <h3 class="card-title" id="admin-deal-form-title"><i class="fas fa-edit"></i> Add/Edit Deal (Admin)</h3>
                        <form>
                            <div class="form-group">
                                <label for="admin-deal-title">Deal Title</label>
                                <input type="text" id="admin-deal-title" placeholder="e.g., 20% Off Restaurant Bill">
                            </div>
                            <div class="form-group">
                                <label for="admin-deal-description">Description</label>
                                <textarea id="admin-deal-description" rows="3" placeholder="Brief description of the deal, terms, etc."></textarea>
                            </div>
                            <div class="form-group">
                                <label for="admin-deal-partner">Partner Name (Select Existing or Type New)</label>
                                <select id="admin-deal-partner" class="form-control">
                                    <!-- Businesses will be loaded dynamically here -->
                                </select>
                                <input type="text" id="admin-new-partner-name" placeholder="Or enter new partner name if not in list" style="margin-top: 5px;">
                            </div>
                            <div class="form-group">
                                <label for="admin-deal-category">Category</label>
                                <input type="text" id="admin-deal-category" placeholder="e.g., Food, Travel, Retail">
                            </div>
                            <div class="form-group">
                                <label for="admin-deal-applicable-plans">Applicable Plans (select all that apply)</label>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="admin-deal-plan-free">
                                    <label for="admin-deal-plan-free">Community Plan</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="admin-deal-plan-basic">
                                    <label for="admin-deal-plan-basic">Silver Plan</label>
                                </div>
                                <div class="checkbox-group">
                                    <input type="checkbox" id="admin-deal-plan-premium">
                                    <label for="admin-deal-plan-premium">Gold Plan</label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="admin-deal-expiry-date">Expiry Date</label>
                                <input type="date" id="admin-deal-expiry-date">
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="admin-deal-active" checked>
                                <label for="admin-deal-active">Deal Active</label>
                            </div>
                            <button type="submit" class="btn btn-success" id="admin-save-deal-btn" style="margin-top: 15px;"><i class="fas fa-save"></i> Save Deal</button>
                            <button type="button" class="btn btn-secondary" id="admin-cancel-deal-btn" style="margin-left: 10px;"><i class="fas fa-times"></i> Cancel</button>
                        </form>
                    </div>
                </div>

                <!-- Business Management Tab -->
                <div class="tab-content" id="business-management-tab" style="display: none;">
                    <h3 class="card-title"><i class="fas fa-building"></i> Manage Business Sectors & Partners (Admin View)</h3>
                    <p style="margin-bottom: 20px;">Add, edit, or remove business sectors and partners.</p>

                    <div class="admin-settings-grid">
                        <!-- Sector Management -->
                        <div class="settings-group">
                            <h3>Business Sectors</h3>
                            <div class="form-group">
                                <label for="new-sector">Add New Sector</label>
                                <input type="text" id="new-sector" placeholder="Enter sector name">
                                <button class="btn btn-primary btn-block" id="add-sector-btn" style="margin-top: 10px;"><i class="fas fa-plus"></i> Add Sector</button>
                            </div>

                            <div id="sectors-list" style="max-height: 300px; overflow-y: auto; margin-top: 15px;">
                                <!-- Sectors will be dynamically populated here -->
                            </div>
                        </div>

                        <!-- Business Management -->
                        <div class="settings-group">
                            <h3>Business Partners (for deals)</h3>
                            <div class="form-group">
                                <label for="business-name">Business Name</label>
                                <input type="text" id="business-name" placeholder="Enter business name">

                                <label for="business-sector">Sector</label>
                                <select id="business-sector" class="form-control">
                                    <!-- Sectors will be populated here -->
                                </select>

                                <label for="business-logo">Logo URL</label>
                                <input type="text" id="business-logo" placeholder="Enter logo URL">
                                <small>Upload an image and enter URL here</small>

                                <button class="btn btn-primary btn-block" id="add-business-btn" style="margin-top: 10px;"><i class="fas fa-plus"></i> Add Business</button>
                            </div>

                            <div id="businesses-list" style="max-height: 300px; overflow-y: auto; margin-top: 15px;">
                                <!-- Businesses will be dynamically populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Merchant Management Tab -->
                <div class="tab-content" id="merchant-management-tab" style="display: none;">
                    <h3 class="card-title"><i class="fas fa-users-cog"></i> Manage Merchant Accounts</h3>
                    <p style="margin-bottom: 20px;">Approve new merchants, edit details, or deactivate accounts.</p>

                    <div class="form-group">
                        <input type="text" id="merchant-search" placeholder="Search by Business Name or Email">
                        <button class="btn btn-primary" style="margin-top: 10px;"><i class="fas fa-search"></i> Search</button>
                    </div>

                    <div id="merchant-list" style="max-height: 400px; overflow-y: auto; border: 1px solid #eee; border-radius: 8px; padding: 10px;">
                        <!-- Merchant items will be dynamically populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- About Page -->
        <div id="about-page" class="page">
            <div class="card about-section">
                <h2 class="card-title"><i class="fas fa-info-circle"></i> About Indians in Ghana</h2>
                <div class="about-content">
                    <p>Welcome to Indians in Ghana, the premier community platform for Indian expatriates living and working in Ghana. Our mission is to foster a strong, supportive community that helps Indians thrive in Ghana while preserving our rich cultural heritage.</p>

                    <h3>Our History</h3>
                    <p>Founded in 2010, Indians in Ghana started as a small gathering of professionals looking to connect with fellow countrymen. Over the years, we've grown into a vibrant community of over 1,000 members with diverse backgrounds and professions.</p>

                    <h3>Our Mission</h3>
                    <p>We aim to:</p>
                    <ul>
                        <li>Provide a supportive network for Indians living in Ghana</li>
                        <li>Preserve and promote Indian culture and traditions</li>
                        <li>Facilitate business connections and opportunities</li>
                        <li>Offer assistance to new arrivals in Ghana</li>
                        <li>Organize cultural and social events throughout the year</li>
                    </ul>

                    <h3>Community Activities</h3>
                    <p>We organize regular events including:</p>
                    <ul>
                        <li>Diwali and Holi celebrations</li>
                        <li>Business networking events</li>
                        <li>Cultural workshops and language classes</li>
                        <li>Charity initiatives supporting local communities</li>
                        <li>Sports tournaments and family picnics</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Contact Page -->
        <div id="contact-page" class="page">
            <div class="card contact-section">
                <h2 class="card-title"><i class="fas fa-envelope"></i> Contact Us</h2>
                <div class="contact-content">
                    <p>Have questions or need assistance? Reach out to us through any of the following channels:</p>

                    <div class="contact-info" style="margin-top: 20px;">
                        <p><strong>Email:</strong> contact@indiansinghana.com</p>
                        <p><strong>Phone:</strong> +233 24 123 4567</p>
                        <p><strong>Address:</strong> 123 Community Center, Osu, Accra, Ghana</p>
                        <p><strong>Office Hours:</strong> Monday-Friday, 9:00 AM - 5:00 PM</p>
                    </div>

                    <div class="contact-form">
                        <h3>Send us a Message</h3>
                        <form id="contactForm">
                            <div class="form-group">
                                <label for="contactName">Your Name</label>
                                <input type="text" id="contactName" class="form-control" required>
                            </div>

                            <div class="form-group">
                                <label for="contactEmail">Email Address</label>
                                <input type="email" id="contactEmail" class="form-control" required>
                            </div>

                            <div class="form-group">
                                <label for="contactSubject">Subject</label>
                                <input type="text" id="contactSubject" class="form-control" required>
                            </div>

                            <div class="form-group">
                                <label for="contactMessage">Message</label>
                                <textarea id="contactMessage" class="form-control" rows="5" required></textarea>
                            </div>

                            <div class="form-group">
                                <button type="submit" class="btn btn-primary">Send Message</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>&copy; 2025 Indians in Ghana Community. All rights reserved.</p>
        <p style="margin-top: 10px;">
            Connecting the Indian diaspora in Ghana through cultural events, business networking, and exclusive benefits.
        </p>
        <p style="margin-top: 10px; font-size: 0.85rem;">
            Contact: info@indiansinghana.com | +233 24 123 4567 | Accra, Ghana
        </p>
    </footer>

    <!-- Custom Notification Element -->
    <div class="notification" id="notification">
        <i class="fas fa-info-circle"></i>
        <span></span>
    </div>

    <script>
        // Global state for application (mimicking a database/backend)
        let appState = {
            currentUser: null, // Stores currently logged-in user, admin, or merchant details
            users: [ // Sample users for demonstration
                {
                    fullName: "Rajesh Kumar", email: "rajesh.kumar@example.com", password: "user123",
                    phone: "+233551234567", address: "123 Osu Street, Accra", photoUrl: "",
                    plan: "premium", cardNumber: "IGH-2025-123456", expiry: "Dec 31, 2025", status: "active",
                    isMerchant: false
                },
                {
                    fullName: "Priya Sharma", email: "priya.sharma@example.com", password: "user123",
                    phone: "+233209876543", address: "45 Cantonments Road, Accra", photoUrl: "",
                    plan: "basic", cardNumber: "IGH-2025-789012", expiry: "Nov 30, 2025", status: "pending",
                    isMerchant: false
                },
                {
                    fullName: "Amit Patel", email: "amit.patel@example.com", password: "user123",
                    phone: "+233241122334", address: "78 Labadi Beach, Accra", photoUrl: "",
                    plan: "free", cardNumber: "IGH-2025-234567", expiry: "Oct 31, 2025", status: "active",
                    isMerchant: false
                }
            ],
            merchants: [ // Sample merchants
                {
                    id: 'm1', name: "Taste of India", email: "toi@example.com", password: "merchant123",
                    phone: "+233240001111", address: "East Legon, Accra", category: "Food", logo: "https://placehold.co/60x60/FFD166/073B4C?text=TOI", status: "active"
                },
                {
                    id: 'm2', name: "Bharat Mart", email: "bm@example.com", password: "merchant123",
                    phone: "+233200002222", address: "Osu, Accra", category: "Retail", logo: "https://placehold.co/60x60/06D6A0/073B4C?text=BM", status: "pending"
                }
            ],
            deals: [ // Sample deals
                { id: 'd1', title: 'Restaurant Discount', description: '20% OFF on all dine-in orders!', partner: 'Taste of India', partnerId: 'm1', category: 'Food', plans: ['basic', 'premium'], expiry: '2026-12-31', active: true, redemptions: 120 },
                { id: 'd2', title: 'Grocery Store Offer', description: '₵50 off on purchases over ₵300!', partner: 'Bharat Mart', partnerId: 'm2', category: 'Retail', plans: ['basic', 'premium'], expiry: '2026-06-30', active: true, redemptions: 85 },
                { id: 'd3', title: 'Travel Agency Discount', description: '10% off on flight bookings to India!', partner: 'Global Travels', partnerId: 'm3', category: 'Travel', plans: ['premium'], expiry: '2025-12-31', active: true, redemptions: 45 },
                { id: 'd4', title: 'Free Consultation', description: 'First 30-min legal consultation free!', partner: 'Legal Aid Ghana', partnerId: 'm4', category: 'Services', plans: ['free', 'basic', 'premium'], expiry: '2025-10-31', active: true, redemptions: 250 },
                { id: 'd5', title: 'Past Deal: Old Restaurant Offer', description: 'Expired 10% off', partner: 'Expired Eatery', partnerId: 'm5', category: 'Food', plans: ['basic'], expiry: '2024-01-01', active: false, redemptions: 50 },
                { id: 'd6', title: 'Upcoming Deal: New Year Sale', description: 'Huge discounts coming next year!', partner: 'Big Bazaar', partnerId: 'm6', category: 'Retail', plans: ['premium'], expiry: '2026-01-01', active: true, redemptions: 0 }
            ],
            sectors: [
                { id: 's1', name: 'Restaurants' },
                { id: 's2', name: 'Retail' },
                { id: 's3', name: 'Travel' },
                { id: 's4', name: 'Services' },
                { id: 's5', name: 'Health' },
                { id: 's6', name: 'Education' }
            ],
            businesses: [ // These are general business listings, some might also be merchants
                { id: 'b1', name: 'Taste of India', sector: 's1', logo: 'https://placehold.co/60x60/FFD166/073B4C?text=TOI' },
                { id: 'b2', name: 'Bharat Mart', sector: 's2', logo: 'https://placehold.co/60x60/06D6A0/073B4C?text=BM' },
                { id: 'b3', name: 'Global Travels', sector: 's3', logo: 'https://placehold.co/60x60/118AB2/FFFFFF?text=GT' },
                { id: 'b4', name: 'Legal Aid Ghana', sector: 's4', logo: 'https://placehold.co/60x60/7400b8/FFFFFF?text=LAG' }
            ],
            adminSettings: {
                cardLayout: "idcard", // "idcard" or "passport"
                socialRequirements: { // Which social links are required for registration
                    facebook: true,
                    instagram: true,
                    youtube: false,
                    whatsappChannel: true,
                    whatsappGroup: true
                },
                socialLinks: { // Actual social media links
                    facebook: "https://www.facebook.com/indiansinghana",
                    instagram: "https://instagram.com/indiansinghana",
                    youtube: "https://www.youtube.com/indiansinghana",
                    whatsappChannel: "https://whatsapp.com/channel/indiansinghana",
                    whatsappGroup: "https://chat.whatsapp.com/indiansinghana"
                },
                showPlanSelection: true, // Show plan selection during registration
                plans: {
                    free: {
                        name: "Community Plan",
                        price: "FREE",
                        features: ["Basic digital card", "Limited deal access", "Community updates", "Valid for 1 year"],
                        value: "free"
                    },
                    basic: {
                        name: "Silver Plan",
                        price: 150,
                        features: ["Enhanced digital card", "Access to all deals (5-15% discounts)", "Priority email support", "Event invitations", "Valid for 1 year"],
                        value: "basic"
                    },
                    premium: {
                        name: "Gold Plan",
                        price: 300,
                        features: ["Premium digital card", "VIP access to all deals (15-30% discounts)", "24/7 dedicated support", "Exclusive event access", "Free partner services offers", "Valid for 1 year"],
                        value: "premium"
                    }
                },
                systemName: "Indians in Ghana Membership",
                adminNotificationEmail: "admin@indiansinghana.com",
                cardExpiryPeriod: 365, // Days
                autoApproveFree: true, // Auto-approve free plan registrations
                loginImage: "https://images.unsplash.com/photo-1552664730-d307ca884978?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80",
                termsConditions: `
                    <h4>1. Membership Eligibility & Usage</h4>
                    <p>Membership is open to individuals of Indian origin residing in Ghana. The digital membership card is strictly for personal use and is non-transferable. Misuse may lead to termination of membership without refund.</p>
                    <h4>2. Exclusive Deals & Benefits</h4>
                    <p>Access to exclusive deals and benefits from partner businesses is subject to availability and terms set by the respective partners. Indians in Ghana (IIG) is not responsible for the services or products provided by partner businesses. Benefits may be added or removed at IIG's discretion.</p>
                    <h4>3. Data Privacy</h4>
                    <p>Your personal data collected during registration will be used solely for managing your membership and providing relevant community updates and offers. We adhere to strict data protection practices and will not share your data with third parties without your explicit consent, except as required by law.</p>
                    <h4>4. Payment & Refunds</h4>
                    <p>Membership fees, where applicable, are non-refundable. Activation of paid plans is contingent upon successful payment verification by the IIG administration. Delays may occur due to bank processing times.</p>
                    <h4>5. Account Deletion</h4>
                    <p>Members can request account deletion at any time through the user settings. Deleting your account will remove your access to membership benefits and associated data from our system. This action is irreversible.</p>
                    <h4>6. Governing Law</h4>
                    <p>These terms and conditions are governed by the laws of Ghana. Any disputes arising shall be subject to the exclusive jurisdiction of the courts of Ghana.</p>
                `,
                showStats: true
            },
            stats: {
                cardHolders: 245,
                businesses: 42,
                deals: 18,
                dealsUsed: 1532
            }
        };

        // --- Utility Functions ---

        /**
         * Displays a custom notification message.
         * @param {string} message - The message to display.
         * @param {'success'|'error'|'info'} type - Type of notification (changes color and icon).
         */
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.querySelector('span').textContent = message;
            notification.className = 'notification'; // Reset classes
            notification.classList.add(type);
            notification.classList.add('show');

            const icon = notification.querySelector('i');
            icon.className = ''; // Reset icon class
            if (type === 'success') {
                icon.classList.add('fas', 'fa-check-circle');
            } else if (type === 'error') {
                icon.classList.add('fas', 'fa-exclamation-circle');
            } else {
                icon.classList.add('fas', 'fa-info-circle');
            }

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000); // Hide after 3 seconds
        }

        /**
         * Switches the active page displayed.
         * @param {string} pageId - The ID of the page to show (e.g., 'home', 'membership').
         */
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.style.display = 'none';
                page.classList.remove('active');
            });

            const page = document.getElementById(`${pageId}-page`);
            if (page) {
                page.style.display = 'block';
                page.classList.add('active');
            }

            // Update active navigation link
            document.querySelectorAll('nav a').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-page') === pageId) {
                    link.classList.add('active');
                }
            });

            // Handle login/logout button visibility and panel visibility
            document.getElementById('login-btn').style.display = 'flex';
            document.getElementById('logout-btn').style.display = 'none';
            document.getElementById('admin-nav-item').style.display = 'none';
            document.getElementById('merchant-nav-item').style.display = 'none';

            if (appState.currentUser) {
                document.getElementById('login-btn').style.display = 'none';
                document.getElementById('logout-btn').style.display = 'flex';
                if (appState.currentUser.isAdmin) {
                    document.getElementById('admin-nav-item').style.display = 'list-item';
                } else if (appState.currentUser.isMerchant) {
                    document.getElementById('merchant-nav-item').style.display = 'list-item';
                }
            }

            // Specific updates for certain pages
            if (pageId === 'membership') {
                updateMembershipCardDisplay();
            } else if (pageId === 'deals') {
                filterDeals('current');
            } else if (pageId === 'settings' && appState.currentUser && !appState.currentUser.isAdmin && !appState.currentUser.isMerchant) {
                // Populate user settings form for regular users
                document.getElementById('setting-full-name').value = appState.currentUser.fullName || '';
                document.getElementById('setting-phone').value = appState.currentUser.phone || '';
                document.getElementById('setting-email').value = appState.currentUser.email || '';
                document.getElementById('setting-address').value = appState.currentUser.address || '';
            } else if (pageId === 'admin') {
                populateAdminSettingsForm();
                populateMemberList();
                populateDealManagementList('admin');
                populateSectorList();
                populateBusinessList();
                populateMerchantList();
            } else if (pageId === 'merchant' && appState.currentUser && appState.currentUser.isMerchant) {
                populateMerchantDealManagementList();
                updateMerchantDealStatistics();
            } else if (pageId === 'home') {
                 // When returning to home, ensure login tabs are reset
                switchTab(document.querySelector('#home-page .tabs .btn[data-tab="user-phone"]'), 'user');
            }
            window.scrollTo(0, 0); // Scroll to top on page switch
        }


        /**
         * Handles tab switching within login and admin/merchant panels.
         * @param {HTMLElement} tabElement - The clicked tab element.
         * @param {string} tabGroupPrefix - Prefix for tab content IDs (e.g., 'user', 'admin', 'merchant').
         */
        function switchTab(tabElement, tabGroupPrefix) {
            document.querySelectorAll(`#${tabGroupPrefix}-page .tabs .btn`).forEach(tab => {
                tab.classList.remove('active');
            });
            tabElement.classList.add('active');

            document.querySelectorAll(`#${tabGroupPrefix}-page .tab-content`).forEach(content => {
                content.classList.remove('active');
                content.style.display = 'none';
            });

            const tabId = tabElement.getAttribute('data-tab');
            const tabContent = document.getElementById(`${tabId}-tab`);
            if (tabContent) {
                tabContent.classList.add('active');
                tabContent.style.display = 'block';
            }
        }

        /**
         * Generates a unique member ID.
         * @returns {string} - A unique member ID string.
         */
        function generateMemberId() {
            const year = new Date().getFullYear();
            const randomNum = Math.floor(100000 + Math.random() * 900000);
            return `IGH-${year}-${randomNum}`;
        }

        /**
         * Generates a QR code on the canvas.
         * @param {string} data - The data to encode in the QR code.
         */
        function generateQRCode(data) {
            const qrcodeDisplay = document.getElementById('qrcode-display');
            if (!qrcodeDisplay) return;

            qrcodeDisplay.innerHTML = ''; // Clear previous QR

            new QRCode(qrcodeDisplay, {
                text: data,
                width: 120,
                height: 120,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });

            // Re-add logo to QR code
            const qrLogoDiv = document.createElement('div');
            qrLogoDiv.className = 'qrcode-logo';
            qrLogoDiv.innerHTML = '<i class="fas fa-users" style="color: var(--dark);"></i>';
            qrcodeDisplay.appendChild(qrLogoDiv);
        }

        /**
         * Draws a barcode on the canvas using JsBarcode.
         * @param {string} data - The data to encode in the barcode.
         */
        function drawBarcode(data) {
            const barcodeCanvas = document.getElementById('barcode-display');
            if (!barcodeCanvas) return;
            // JsBarcode expects a canvas element or ID
            JsBarcode(barcodeCanvas, data, {
                format: "CODE128", // Or other formats like EAN13, CODE39
                lineColor: "#073B4C",
                width: 2,
                height: 50,
                displayValue: false // Show value manually below if desired
            });
        }

        /**
         * Calculates the expiry date based on the current date and configured period.
         * @returns {string} - Formatted expiry date string.
         */
        function calculateExpiryDate() {
            const today = new Date();
            const expiry = new Date(today);
            expiry.setDate(today.getDate() + appState.adminSettings.cardExpiryPeriod);

            return expiry.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        /**
         * Updates the displayed membership card with current user data and admin settings.
         */
        function updateMembershipCardDisplay() {
            const card = document.getElementById('membership-card-display');
            if (!appState.currentUser || appState.currentUser.isAdmin || appState.currentUser.isMerchant) {
                // If no user or it's admin/merchant, hide card
                if (card) card.style.display = 'none';
                return;
            }
            if (card) card.style.display = 'flex'; // Show card

            // Reset classes
            if (card) card.className = 'membership-card';

            // Apply layout
            if (card) card.classList.add(`layout-${appState.adminSettings.cardLayout}`);

            // Apply plan-based background
            const userPlanValue = appState.currentUser.plan;
            const planKey = Object.keys(appState.adminSettings.plans).find(key =>
                appState.adminSettings.plans[key].value === userPlanValue
            );
            if (planKey && card) {
                card.classList.add(`plan-${planKey}`);
                document.getElementById('card-plan-name-badge').textContent = appState.adminSettings.plans[planKey].name;
                document.getElementById('card-plan-footer').textContent = appState.adminSettings.plans[planKey].name;
            } else {
                 if (document.getElementById('card-plan-name-badge')) document.getElementById('card-plan-name-badge').textContent = "Unknown Plan";
                 if (document.getElementById('card-plan-footer')) document.getElementById('card-plan-footer').textContent = "Unknown Plan";
            }

            // Update user info
            if (document.getElementById('card-name')) document.getElementById('card-name').textContent = appState.currentUser.fullName || "Member Name";
            if (document.getElementById('card-unique-number')) document.getElementById('card-unique-number').textContent = appState.currentUser.cardNumber || "IGH-XXXX-XXXXXX";
            if (document.getElementById('card-expiry-footer')) document.getElementById('card-expiry-footer').textContent = appState.currentUser.expiry || "N/A";

            // Update QR code and Barcode
            const qrData = `INDIANSINGHANA-MEMBERID:${appState.currentUser.cardNumber}`;
            generateQRCode(qrData);
            drawBarcode(appState.currentUser.cardNumber);

            // Placeholder for actual photo upload
            const cardAvatar = document.getElementById('card-avatar');
            if (cardAvatar) {
                cardAvatar.innerHTML = '<i class="fas fa-user"></i>'; // Default icon
                if (appState.currentUser.photoUrl) {
                    const img = new Image();
                    img.src = appState.currentUser.photoUrl;
                    img.onerror = () => { /* Handle broken image */ };
                    cardAvatar.innerHTML = '';
                    cardAvatar.appendChild(img);
                }
            }
        }

        /**
         * Populates the plan selection dropdown based on admin settings.
         */
        function populatePlanSelection() {
            const selectElement = document.getElementById('selected-plan');
            if (!selectElement) return;

            selectElement.innerHTML = ''; // Clear existing options

            // Iterate over plans defined in appState.adminSettings.plans
            for (const key in appState.adminSettings.plans) {
                const plan = appState.adminSettings.plans[key];
                const option = document.createElement('option');
                option.value = plan.value;
                option.textContent = `${plan.name} (${typeof plan.price === 'number' ? '₵' + plan.price : plan.price})`;
                selectElement.appendChild(option);
            }

            // Show/hide plan section based on admin setting
            const planTitle = document.getElementById('plan-selection-title');
            const planContainer = document.getElementById('plan-selection-container');
            if (planTitle && planContainer) {
                if (appState.adminSettings.showPlanSelection) {
                    planTitle.style.display = 'flex';
                    planContainer.style.display = 'block';
                } else {
                    planTitle.style.display = 'none';
                    planContainer.style.display = 'none';
                }
            }
        }

        /**
         * Populates the social media requirements in the registration form.
         */
        function populateSocialRequirements() {
            const socialGrid = document.getElementById('registration-social-grid');
            if (!socialGrid) return;

            socialGrid.innerHTML = ''; // Clear existing

            for (const socialKey in appState.adminSettings.socialRequirements) {
                if (appState.adminSettings.socialRequirements[socialKey]) {
                    const socialItem = document.createElement('a');
                    socialItem.href = appState.adminSettings.socialLinks[socialKey];
                    socialItem.target = "_blank";
                    socialItem.className = `social-item ${socialKey} social-required`;
                    // Adjust icon classes for WhatsApp variants
                    const iconClass = socialKey.includes('whatsapp') ? 'fab fa-whatsapp' : `fab fa-${socialKey}`;
                    const textContent = socialKey.replace('whatsappChannel', 'WhatsApp Channel').replace('whatsappGroup', 'WhatsApp Group').replace('youtube', 'YouTube');
                    socialItem.innerHTML = `<i class="${iconClass}"></i><span>Follow our ${textContent}</span>`;
                    socialGrid.appendChild(socialItem);
                }
            }
        }

        /**
         * Populates the admin settings form with current appState values.
         */
        function populateAdminSettingsForm() {
            // Social Media
            if (document.getElementById('req-facebook')) document.getElementById('req-facebook').checked = appState.adminSettings.socialRequirements.facebook;
            if (document.getElementById('facebook-link')) document.getElementById('facebook-link').value = appState.adminSettings.socialLinks.facebook;
            if (document.getElementById('req-instagram')) document.getElementById('req-instagram').checked = appState.adminSettings.socialRequirements.instagram;
            if (document.getElementById('instagram-link')) document.getElementById('instagram-link').value = appState.adminSettings.socialLinks.instagram;
            if (document.getElementById('req-youtube')) document.getElementById('req-youtube').checked = appState.adminSettings.socialRequirements.youtube;
            if (document.getElementById('youtube-link')) document.getElementById('youtube-link').value = appState.adminSettings.socialLinks.youtube;
            if (document.getElementById('req-whatsapp-channel')) document.getElementById('req-whatsapp-channel').checked = appState.adminSettings.socialRequirements.whatsappChannel;
            if (document.getElementById('whatsapp-channel-link')) document.getElementById('whatsapp-channel-link').value = appState.adminSettings.socialLinks.whatsappChannel;
            if (document.getElementById('req-whatsapp-group')) document.getElementById('req-whatsapp-group').checked = appState.adminSettings.socialRequirements.whatsappGroup;
            if (document.getElementById('whatsapp-group-link')) document.getElementById('whatsapp-group-link').value = appState.adminSettings.socialLinks.whatsappGroup;

            // Plan Settings
            if (document.getElementById('show-plan-selection')) document.getElementById('show-plan-selection').checked = appState.adminSettings.showPlanSelection;
            if (document.getElementById('card-layout-select')) document.getElementById('card-layout-select').value = appState.adminSettings.cardLayout;

            if (document.getElementById('free-plan-name')) document.getElementById('free-plan-name').value = appState.adminSettings.plans.free.name;
            if (document.getElementById('free-plan-features')) document.getElementById('free-plan-features').value = appState.adminSettings.plans.free.features.join(',');
            if (document.getElementById('basic-plan-name')) document.getElementById('basic-plan-name').value = appState.adminSettings.plans.basic.name;
            if (document.getElementById('basic-plan-price')) document.getElementById('basic-plan-price').value = appState.adminSettings.plans.basic.price;
            if (document.getElementById('basic-plan-features')) document.getElementById('basic-plan-features').value = appState.adminSettings.plans.basic.features.join(',');
            if (document.getElementById('premium-plan-name')) document.getElementById('premium-plan-name').value = appState.adminSettings.plans.premium.name;
            if (document.getElementById('premium-plan-price')) document.getElementById('premium-plan-price').value = appState.adminSettings.plans.premium.price;
            if (document.getElementById('premium-plan-features')) document.getElementById('premium-plan-features').value = appState.adminSettings.plans.premium.features.join(',');

            // System Settings
            if (document.getElementById('system-name')) document.getElementById('system-name').value = appState.adminSettings.systemName;
            if (document.getElementById('admin-notification-email')) document.getElementById('admin-notification-email').value = appState.adminSettings.adminNotificationEmail;
            if (document.getElementById('card-expiry-period')) document.getElementById('card-expiry-period').value = appState.adminSettings.cardExpiryPeriod;
            if (document.getElementById('auto-approve-free')) document.getElementById('auto-approve-free').checked = appState.adminSettings.autoApproveFree;
            if (document.getElementById('login-image-url')) document.getElementById('login-image-url').value = appState.adminSettings.loginImage;
            if (document.getElementById('terms-conditions')) document.getElementById('terms-conditions').value = appState.adminSettings.termsConditions;
            if (document.getElementById('show-stats')) document.getElementById('show-stats').checked = appState.adminSettings.showStats;

            // Set login image preview
            if (document.getElementById('login-image')) document.getElementById('login-image').src = appState.adminSettings.loginImage;

            // Set terms HTML
            if (document.getElementById('terms-container')) document.getElementById('terms-container').innerHTML = appState.adminSettings.termsConditions;
        }

        /**
         * Populates the business sectors and businesses on the login page.
         */
        function populateBusinessSectors() {
            const container = document.getElementById('business-sectors-container');
            if (!container) return;
            container.innerHTML = '';

            appState.sectors.forEach(sector => {
                const businesses = appState.businesses.filter(b => b.sector === sector.id);

                const sectorDiv = document.createElement('div');
                sectorDiv.innerHTML = `
                    <h4 class="sector-title">${sector.name} (${businesses.length})</h4>
                    <div class="business-grid">
                        ${businesses.map(business => `
                            <div class="business-item">
                                <div class="business-logo">
                                    ${business.logo ?
                                        `<img src="${business.logo}" alt="${business.name}" onerror="this.onerror=null;this.src='https://placehold.co/60x60/F8F9FA/073B4C?text=Logo';">` :
                                        `<i class="fas fa-building"></i>`
                                    }
                                </div>
                                <h5>${business.name}</h5>
                            </div>
                        `).join('')}
                    </div>
                `;
                container.appendChild(sectorDiv);
            });
        }

        /**
         * Populates the statistics on the login page.
         */
        function populateStatistics() {
            const container = document.getElementById('stats-container');
            if (!container) return;

            if (!appState.adminSettings.showStats) {
                container.style.display = 'none';
                return;
            }

            container.style.display = 'grid'; // Ensure it's visible if showStats is true

            container.innerHTML = `
                <div class="stat-card">
                    <i class="fas fa-id-card" style="font-size: 2rem; color: var(--primary);"></i>
                    <div class="stat-value">${appState.stats.cardHolders}</div>
                    <div class="stat-label">Card Holders</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-building" style="font-size: 2rem; color: var(--primary);"></i>
                    <div class="stat-value">${appState.stats.businesses}</div>
                    <div class="stat-label">Businesses</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-tags" style="font-size: 2rem; color: var(--primary);"></i>
                    <div class="stat-value">${appState.stats.deals}</div>
                    <div class="stat-label">Active Deals</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-hand-holding-usd" style="font-size: 2rem; color: var(--primary);"></i>
                    <div class="stat-value">${appState.stats.dealsUsed}</div>
                    <div class="stat-label">Deals Used</div>
                </div>
            `;
        }

        /**
         * Filters and displays exclusive deals based on the selected filter.
         * @param {string} filterType - 'current', 'past', or 'upcoming'.
         */
        function filterDeals(filterType) {
            const dealsListDiv = document.getElementById('deals-list');
            if (!dealsListDiv) return;
            dealsListDiv.innerHTML = ''; // Clear existing

            const today = new Date();
            today.setHours(0, 0, 0, 0); // Normalize today to start of day for comparison

            let filteredDeals = [];

            // Filter deals based on type
            if (filterType === 'current') {
                filteredDeals = appState.deals.filter(deal =>
                    deal.active && new Date(deal.expiry) >= today
                );
            } else if (filterType === 'past') {
                filteredDeals = appState.deals.filter(deal =>
                    new Date(deal.expiry) < today
                );
            } else if (filterType === 'upcoming') {
                filteredDeals = appState.deals.filter(deal =>
                    deal.active && new Date(deal.expiry) > today && new Date(deal.expiry) > new Date(today.setDate(today.getDate() + 7)) // Example: more than 7 days from now
                );
            }

            if (!appState.currentUser) {
                dealsListDiv.innerHTML = '<p style="text-align: center; color: #888; padding: 20px;">Please login to view exclusive deals.</p>';
                return;
            }
            if (appState.currentUser.isMerchant) {
                 dealsListDiv.innerHTML = '<p style="text-align: center; color: #888; padding: 20px;">Merchant accounts do not view member deals here. Please go to Merchant Panel.</p>';
                 return;
            }

            const userPlan = appState.currentUser.plan;
            const applicableDeals = filteredDeals.filter(deal => deal.plans.includes(userPlan));

            if (applicableDeals.length === 0) {
                dealsListDiv.innerHTML = `<p style="text-align: center; color: #888; padding: 20px;">No ${filterType} deals currently available for your membership plan. Check back later!</p>`;
                return;
            }

            applicableDeals.forEach(deal => {
                const dealItem = document.createElement('div');
                dealItem.className = 'deal-item card';
                dealItem.style.padding = '15px';
                dealItem.style.textAlign = 'left';
                dealItem.style.boxShadow = 'var(--box-shadow-light)';
                dealItem.style.border = '1px solid #eee';

                dealItem.innerHTML = `
                    <h4 style="font-size: 1.2rem; color: var(--dark); margin-bottom: 5px;">${deal.title}</h4>
                    <p style="font-weight: bold; color: var(--primary);">${deal.description}</p>
                    <p style="font-size: 0.9em; color: #666;">At "${deal.partner}" (Category: ${deal.category})</p>
                    <p style="font-size: 0.8em; color: #999;">Expires: ${new Date(deal.expiry).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</p>
                    <div class="deal-actions">
                        <button class="btn btn-primary btn-sm">View Details</button>
                        <button class="used-btn" data-deal-id="${deal.id}" data-partner-id="${deal.partnerId}">Mark as Used</button>
                    </div>
                `;
                dealsListDiv.appendChild(dealItem);
            });
        }


        /**
         * Populates the member list in the admin panel.
         */
        function populateMemberList() {
            const memberListDiv = document.getElementById('member-list');
            if (!memberListDiv) return;
            memberListDiv.innerHTML = ''; // Clear existing

            if (appState.users.length === 0) {
                memberListDiv.innerHTML = '<p style="text-align: center; color: #888; padding: 20px;">No registered members yet.</p>';
                return;
            }

            appState.users.forEach(member => {
                const memberCard = document.createElement('div');
                memberCard.className = 'card';
                memberCard.style.padding = '15px';
                memberCard.style.marginBottom = '10px';
                memberCard.style.boxShadow = 'none';
                memberCard.style.borderLeft = `5px solid ${member.status === 'active' ? 'var(--success)' : 'var(--warning)'}`;

                memberCard.innerHTML = `
                    <h4 style="font-size: 1.1rem; margin-bottom: 5px; color: var(--dark);">${member.fullName} <span style="font-weight: normal; color: #888;">(${member.cardNumber})</span></h4>
                    <p style="font-size: 0.9em; color: #666;">Phone: ${member.phone} | Email: ${member.email} | Plan: ${appState.adminSettings.plans[member.plan]?.name || 'N/A'} | Status: <span style="color: ${member.status === 'active' ? 'var(--success)' : 'var(--warning)'}; font-weight: bold;">${member.status.charAt(0).toUpperCase() + member.status.slice(1)}</span></p>
                    <div style="margin-top: 10px;">
                        <button class="btn btn-primary btn-sm edit-member-btn" data-member-id="${member.cardNumber}"><i class="fas fa-edit"></i> Edit</button>
                        ${member.status === 'pending' ? `<button class="btn btn-success btn-sm approve-member-btn" data-member-id="${member.cardNumber}"><i class="fas fa-check"></i> Approve</button>` : ''}
                        <button class="btn btn-secondary btn-sm view-card-btn" data-member-id="${member.cardNumber}"><i class="fas fa-eye"></i> View Card</button>
                        <button class="btn btn-danger btn-sm delete-member-btn" data-member-id="${member.cardNumber}"><i class="fas fa-trash"></i> Delete</button>
                    </div>
                `;
                memberListDiv.appendChild(memberCard);
            });

            // Add event listeners for member actions (Edit, Approve, Delete, View Card)
            memberListDiv.querySelectorAll('.approve-member-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const memberId = e.target.closest('button').dataset.memberId;
                    approveMember(memberId);
                });
            });
            memberListDiv.querySelectorAll('.delete-member-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const memberId = e.target.closest('button').dataset.memberId;
                    // Use a custom modal for confirmation instead of window.confirm
                    showCustomConfirm('Are you sure you want to delete this member? This action cannot be undone.', () => {
                        deleteMember(memberId);
                    });
                });
            });
            memberListDiv.querySelectorAll('.view-card-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const memberId = e.target.closest('button').dataset.memberId;
                    viewMemberCardAsAdmin(memberId);
                });
            });
            // Implement edit-member-btn similarly, potentially opening a modal/form for editing
            memberListDiv.querySelectorAll('.edit-member-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const memberId = e.target.closest('button').dataset.memberId;
                    // For demo, just show notification. In real app, open edit modal/form.
                    showNotification(`Editing member ${memberId}. (Feature to be implemented: Edit form)`, 'info');
                });
            });
        }

        /**
         * Approves a pending member.
         * @param {string} memberId - The card number of the member to approve.
         */
        function approveMember(memberId) {
            const memberIndex = appState.users.findIndex(m => m.cardNumber === memberId);
            if (memberIndex !== -1) {
                appState.users[memberIndex].status = 'active';
                showNotification(`Member ${appState.users[memberIndex].fullName} approved!`, 'success');
                populateMemberList(); // Refresh list
                populateStatistics(); // Update stats if approval changes count
            }
        }

        /**
         * Deletes a member.
         * @param {string} memberId - The card number of the member to delete.
         */
        function deleteMember(memberId) {
            appState.users = appState.users.filter(m => m.cardNumber !== memberId);
            showNotification('Member deleted successfully!', 'success');
            populateMemberList(); // Refresh list
            populateStatistics(); // Update stats
        }

        /**
         * Allows admin to view a specific member's card.
         * @param {string} memberId - The card number of the member to view.
         */
        function viewMemberCardAsAdmin(memberId) {
            const member = appState.users.find(m => m.cardNumber === memberId);
            if (member) {
                // Temporarily set currentUser to this member to use updateMembershipCardDisplay
                const originalCurrentUser = appState.currentUser;
                appState.currentUser = member;
                showPage('membership');
                updateMembershipCardDisplay();
                appState.currentUser = originalCurrentUser; // Revert currentUser
                showNotification(`Viewing card for ${member.fullName}`, 'info');
            } else {
                showNotification('Member not found!', 'error');
            }
        }

        /**
         * Populates the deal management list in admin panel.
         * @param {string} panelType - 'admin' or 'merchant'
         */
        function populateDealManagementList(panelType) {
            let dealListDiv;
            let filteredDeals = appState.deals;
            if (panelType === 'admin') {
                dealListDiv = document.getElementById('admin-deal-management-list');
            } else if (panelType === 'merchant' && appState.currentUser && appState.currentUser.isMerchant) {
                dealListDiv = document.getElementById('merchant-deal-management-list');
                filteredDeals = appState.deals.filter(d => d.partnerId === appState.currentUser.id);
            }
            if (!dealListDiv) return;
            dealListDiv.innerHTML = ''; // Clear existing

            if (filteredDeals.length === 0) {
                dealListDiv.innerHTML = '<p style="text-align: center; color: #888; padding: 20px;">No deals added yet.</p>';
                return;
            }

            filteredDeals.forEach(deal => {
                const dealCard = document.createElement('div');
                dealCard.className = 'card';
                dealCard.style.padding = '15px';
                dealCard.style.marginBottom = '10px';
                dealCard.style.boxShadow = 'none';
                dealCard.style.borderLeft = `5px solid ${deal.active ? 'var(--success)' : 'var(--danger)'}`;

                dealCard.innerHTML = `
                    <h4 style="font-size: 1.1rem; margin-bottom: 5px; color: var(--dark);">${deal.title} (${deal.partner})</h4>
                    <p style="font-size: 0.9em; color: #666;">${deal.description} | Active: ${deal.active ? 'Yes' : 'No'} | Target: ${deal.plans.map(p => appState.adminSettings.plans[p]?.name || p).join(', ')}</p>
                    <p style="font-size: 0.8em; color: #999;">Redemptions: ${deal.redemptions}</p>
                    <div style="margin-top: 10px;">
                        <button class="btn btn-primary btn-sm edit-deal-btn" data-deal-id="${deal.id}" data-panel-type="${panelType}"><i class="fas fa-edit"></i> Edit</button>
                        <button class="btn btn-danger btn-sm delete-deal-btn" data-deal-id="${deal.id}" data-panel-type="${panelType}"><i class="fas fa-trash"></i> Delete</button>
                    </div>
                `;
                dealListDiv.appendChild(dealCard);
            });

            // Add event listeners for deal actions
            dealListDiv.querySelectorAll('.edit-deal-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const dealId = e.target.closest('button').dataset.dealId;
                    const panel = e.target.closest('button').dataset.panelType;
                    editDeal(dealId, panel);
                });
            });
            dealListDiv.querySelectorAll('.delete-deal-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const dealId = e.target.closest('button').dataset.dealId;
                    const panel = e.target.closest('button').dataset.panelType;
                    showCustomConfirm('Are you sure you want to delete this deal?', () => {
                        deleteDeal(dealId, panel);
                    });
                });
            });
        }

        /**
         * Pre-fills the add/edit deal form for editing an existing deal.
         * @param {string} dealId - The ID of the deal to edit.
         * @param {string} panelType - 'admin' or 'merchant'
         */
        function editDeal(dealId, panelType) {
            const deal = appState.deals.find(d => d.id === dealId);
            let addEditDealForm;
            let titleElement;
            let partnerElement;
            let partnerInput;
            let saveBtn;

            if (panelType === 'admin') {
                addEditDealForm = document.getElementById('admin-add-edit-deal-form');
                titleElement = document.getElementById('admin-deal-form-title');
                partnerElement = document.getElementById('admin-deal-partner');
                partnerInput = document.getElementById('admin-new-partner-name');
                saveBtn = document.getElementById('admin-save-deal-btn');
            } else if (panelType === 'merchant') {
                addEditDealForm = document.getElementById('add-edit-merchant-deal-form');
                titleElement = document.getElementById('merchant-deal-form-title');
                partnerElement = null; // Merchants cannot change partner
                partnerInput = null;
                saveBtn = document.getElementById('save-merchant-deal-btn');
            }

            if (deal && addEditDealForm) {
                titleElement.innerHTML = '<i class="fas fa-edit"></i> Edit Deal';
                addEditDealForm.style.display = 'block';

                document.getElementById(`${panelType}-deal-title`).value = deal.title;
                document.getElementById(`${panelType}-deal-description`).value = deal.description;
                if (panelType === 'admin') {
                    partnerElement.value = deal.partnerId;
                    partnerInput.value = ''; // Clear new partner name when editing existing
                }
                document.getElementById(`${panelType}-deal-category`).value = deal.category;
                document.getElementById(`${panelType}-deal-expiry-date`).value = deal.expiry;
                document.getElementById(`${panelType}-deal-active`).checked = deal.active;

                document.getElementById(`${panelType}-deal-plan-free`).checked = deal.plans.includes('free');
                document.getElementById(`${panelType}-deal-plan-basic`).checked = deal.plans.includes('basic');
                document.getElementById(`${panelType}-deal-plan-premium`).checked = deal.plans.includes('premium');

                saveBtn.dataset.dealId = deal.id; // Store ID for saving
            }
        }

        /**
         * Deletes a deal.
         * @param {string} dealId - The ID of the deal to delete.
         * @param {string} panelType - 'admin' or 'merchant'
         */
        function deleteDeal(dealId, panelType) {
            appState.deals = appState.deals.filter(d => d.id !== dealId);
            showNotification('Deal deleted successfully!', 'success');
            populateDealManagementList(panelType); // Refresh relevant list
            filterDeals('current'); // Refresh user deals view
            populateStatistics(); // Update stats
            updateMerchantDealStatistics(); // Update merchant stats
        }

        /**
         * Handles saving (adding or updating) a deal from the form.
         * @param {string} panelType - 'admin' or 'merchant'
         */
        function saveDeal(panelType) {
            let dealId, title, description, partnerName, category, expiry, active, saveBtn, addEditDealForm;
            let applicablePlans = [];

            if (panelType === 'admin') {
                saveBtn = document.getElementById('admin-save-deal-btn');
                addEditDealForm = document.getElementById('admin-add-edit-deal-form');
                dealId = saveBtn.dataset.dealId;
                title = document.getElementById('admin-deal-title').value;
                description = document.getElementById('admin-deal-description').value;
                const selectedPartnerId = document.getElementById('admin-deal-partner').value;
                const newPartnerName = document.getElementById('admin-new-partner-name').value.trim();

                let partnerObj;
                if (newPartnerName) {
                    partnerObj = { id: 'm' + Date.now(), name: newPartnerName, category: "General", status: "active", email: "", phone: "", address: "", logo: "" }; // Create a new mock merchant
                    appState.merchants.push(partnerObj);
                    // Also add to businesses if it's a new unique business
                    if (!appState.businesses.some(b => b.name === newPartnerName)) {
                        appState.businesses.push({ id: partnerObj.id, name: partnerObj.name, sector: 's-other', logo: partnerObj.logo });
                    }
                    partnerName = newPartnerName;
                } else if (selectedPartnerId) {
                    partnerObj = appState.merchants.find(m => m.id === selectedPartnerId) || appState.businesses.find(b => b.id === selectedPartnerId); // Try to find existing merchant or business
                    partnerName = partnerObj ? partnerObj.name : 'Unknown Partner';
                } else {
                     showNotification('Please select or enter a partner name.', 'error');
                     return;
                }
                category = document.getElementById('admin-deal-category').value;
                expiry = document.getElementById('admin-deal-expiry-date').value;
                active = document.getElementById('admin-deal-active').checked;
                if (document.getElementById('admin-deal-plan-free').checked) applicablePlans.push('free');
                if (document.getElementById('admin-deal-plan-basic').checked) applicablePlans.push('basic');
                if (document.getElementById('admin-deal-plan-premium').checked) applicablePlans.push('premium');

                // If a new partner was created, add it to the businesses list as well if it's not already there
                if (newPartnerName && !appState.businesses.some(b => b.name === newPartnerName)) {
                    appState.businesses.push({
                        id: partnerObj.id, // Use the new merchant ID as business ID
                        name: partnerObj.name,
                        sector: appState.sectors.find(s => s.name === category)?.id || 's-other', // Assign to existing sector or a generic one
                        logo: partnerObj.logo || ''
                    });
                }


            } else if (panelType === 'merchant') {
                saveBtn = document.getElementById('save-merchant-deal-btn');
                addEditDealForm = document.getElementById('add-edit-merchant-deal-form');
                dealId = saveBtn.dataset.dealId;
                title = document.getElementById('merchant-deal-title').value;
                description = document.getElementById('merchant-deal-description').value;
                partnerName = appState.currentUser.name; // Merchant can only add deals for themselves
                category = document.getElementById('merchant-deal-category').value;
                expiry = document.getElementById('merchant-deal-expiry-date').value;
                active = document.getElementById('merchant-deal-active').checked;
                if (document.getElementById('merchant-deal-plan-free').checked) applicablePlans.push('free');
                if (document.getElementById('merchant-deal-plan-basic').checked) applicablePlans.push('basic');
                if (document.getElementById('merchant-deal-plan-premium').checked) applicablePlans.push('premium');
            }

            if (!title || !partnerName || !category || !expiry) {
                showNotification('Please fill all required fields: Title, Partner, Category, Expiry Date.', 'error');
                return;
            }

            if (dealId) {
                // Update existing deal
                const dealIndex = appState.deals.findIndex(d => d.id === dealId);
                if (dealIndex !== -1) {
                    appState.deals[dealIndex] = {
                        ...appState.deals[dealIndex],
                        title, description, partner: partnerName, partnerId: (panelType === 'admin' ? (partnerObj ? partnerObj.id : '') : appState.currentUser.id), category, plans: applicablePlans, expiry, active
                    };
                    showNotification('Deal updated successfully!', 'success');
                }
            } else {
                // Add new deal
                const newDeal = {
                    id: 'd' + Date.now(), // Simple unique ID
                    title, description, partner: partnerName, partnerId: (panelType === 'admin' ? (partnerObj ? partnerObj.id : '') : appState.currentUser.id), category, plans: applicablePlans, expiry, active, redemptions: 0
                };
                appState.deals.push(newDeal);
                showNotification('New deal added successfully!', 'success');
            }

            addEditDealForm.style.display = 'none'; // Hide form
            populateDealManagementList(panelType); // Refresh relevant list
            filterDeals('current'); // Refresh user deals view
            populateStatistics(); // Update stats
            populateBusinessSectors(); // Update business sectors if a new partner was added
            updateMerchantDealStatistics(); // Update merchant stats if called from merchant panel

            // Clear form fields
            document.getElementById(`${panelType}-deal-title`).value = '';
            document.getElementById(`${panelType}-deal-description`).value = '';
            if (panelType === 'admin') {
                document.getElementById('admin-deal-partner').value = '';
                document.getElementById('admin-new-partner-name').value = '';
            }
            document.getElementById(`${panelType}-deal-category`).value = '';
            document.getElementById(`${panelType}-deal-expiry-date`).value = '';
            document.getElementById(`${panelType}-deal-active`).checked = true;
            document.getElementById(`${panelType}-deal-plan-free`).checked = false;
            document.getElementById(`${panelType}-deal-plan-basic`).checked = false;
            document.getElementById(`${panelType}-deal-plan-premium`).checked = false;
            delete saveBtn.dataset.dealId;
        }


        /**
         * Populates the sector list in the admin panel.
         */
        function populateSectorList() {
            const container = document.getElementById('sectors-list');
            if (!container) return;
            container.innerHTML = '';

            if (appState.sectors.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #888; padding: 10px;">No sectors added yet.</p>';
                return;
            }

            appState.sectors.forEach(sector => {
                const sectorItem = document.createElement('div');
                sectorItem.className = 'card';
                sectorItem.style.padding = '10px';
                sectorItem.style.marginBottom = '10px';
                sectorItem.style.boxShadow = 'none';
                sectorItem.style.display = 'flex';
                sectorItem.style.justifyContent = 'space-between';
                sectorItem.style.alignItems = 'center';

                sectorItem.innerHTML = `
                    <span>${sector.name}</span>
                    <div>
                        <button class="btn btn-danger btn-sm delete-sector-btn" data-sector-id="${sector.id}"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                container.appendChild(sectorItem);
            });
        }

        /**
         * Populates the business list in the admin panel and the business sector dropdown.
         */
        function populateBusinessList() {
            const container = document.getElementById('businesses-list');
            if (!container) return;
            container.innerHTML = '';

            if (appState.businesses.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #888; padding: 10px;">No businesses added yet.</p>';
                return;
            }

            appState.businesses.forEach(business => {
                const businessItem = document.createElement('div');
                businessItem.className = 'card';
                businessItem.style.padding = '10px';
                businessItem.style.marginBottom = '10px';
                businessItem.style.boxShadow = 'none';
                businessItem.style.display = 'flex';
                businessItem.style.justifyContent = 'space-between';
                businessItem.style.alignItems = 'center';

                const sector = appState.sectors.find(s => s.id === business.sector) || { name: 'Unknown' };

                businessItem.innerHTML = `
                    <div>
                        <div style="font-weight: bold;">${business.name}</div>
                        <div style="font-size: 0.8em; color: #666;">Sector: ${sector.name}</div>
                    </div>
                    <div>
                        <button class="btn btn-danger btn-sm delete-business-btn" data-business-id="${business.id}"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                container.appendChild(businessItem);
            });

            // Populate sector dropdown for adding/editing businesses
            const sectorSelect = document.getElementById('business-sector');
            if (sectorSelect) {
                sectorSelect.innerHTML = '';
                appState.sectors.forEach(sector => {
                    const option = document.createElement('option');
                    option.value = sector.id;
                    option.textContent = sector.name;
                    sectorSelect.appendChild(option);
                });
            }

            // Populate partner dropdown for admin deal management
            const adminDealPartnerSelect = document.getElementById('admin-deal-partner');
            if (adminDealPartnerSelect) {
                adminDealPartnerSelect.innerHTML = '<option value="">-- Select Existing Partner --</option>';
                appState.merchants.forEach(merchant => {
                    const option = document.createElement('option');
                    option.value = merchant.id;
                    option.textContent = merchant.name;
                    adminDealPartnerSelect.appendChild(option);
                });
                // Also add non-merchant businesses as options for deals if needed
                appState.businesses.filter(b => !appState.merchants.some(m => m.id === b.id)).forEach(business => {
                    const option = document.createElement('option');
                    option.value = business.id;
                    option.textContent = `${business.name} (Non-Merchant)`;
                    adminDealPartnerSelect.appendChild(option);
                });
            }
        }

        /**
         * Populates the merchant list in the admin panel.
         */
        function populateMerchantList() {
            const merchantListDiv = document.getElementById('merchant-list');
            if (!merchantListDiv) return;
            merchantListDiv.innerHTML = '';

            if (appState.merchants.length === 0) {
                merchantListDiv.innerHTML = '<p style="text-align: center; color: #888; padding: 20px;">No registered merchants yet.</p>';
                return;
            }

            appState.merchants.forEach(merchant => {
                const merchantCard = document.createElement('div');
                merchantCard.className = 'card';
                merchantCard.style.padding = '15px';
                merchantCard.style.marginBottom = '10px';
                merchantCard.style.boxShadow = 'none';
                merchantCard.style.borderLeft = `5px solid ${merchant.status === 'active' ? 'var(--success)' : 'var(--warning)'}`;

                merchantCard.innerHTML = `
                    <h4 style="font-size: 1.1rem; margin-bottom: 5px; color: var(--dark);">${merchant.name} <span style="font-weight: normal; color: #888;">(${merchant.email})</span></h4>
                    <p style="font-size: 0.9em; color: #666;">Phone: ${merchant.phone} | Category: ${merchant.category} | Status: <span style="color: ${merchant.status === 'active' ? 'var(--success)' : 'var(--warning)'}; font-weight: bold;">${merchant.status.charAt(0).toUpperCase() + merchant.status.slice(1)}</span></p>
                    <div style="margin-top: 10px;">
                        <button class="btn btn-primary btn-sm edit-merchant-btn" data-merchant-id="${merchant.id}"><i class="fas fa-edit"></i> Edit</button>
                        ${merchant.status === 'pending' ? `<button class="btn btn-success btn-sm approve-merchant-btn" data-merchant-id="${merchant.id}"><i class="fas fa-check"></i> Approve</button>` : ''}
                        <button class="btn btn-danger btn-sm delete-merchant-btn" data-merchant-id="${merchant.id}"><i class="fas fa-trash"></i> Delete</button>
                    </div>
                `;
                merchantListDiv.appendChild(merchantCard);
            });
            // Add event listeners for merchant actions
            merchantListDiv.querySelectorAll('.approve-merchant-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const merchantId = e.target.closest('button').dataset.merchantId;
                    approveMerchantAccount(merchantId);
                });
            });
            merchantListDiv.querySelectorAll('.delete-merchant-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const merchantId = e.target.closest('button').dataset.merchantId;
                    showCustomConfirm('Are you sure you want to delete this merchant account? All their deals will also be removed.', () => {
                        deleteMerchantAccount(merchantId);
                    });
                });
            });
        }

        /**
         * Approves a pending merchant account.
         * @param {string} merchantId - The ID of the merchant to approve.
         */
        function approveMerchantAccount(merchantId) {
            const merchantIndex = appState.merchants.findIndex(m => m.id === merchantId);
            if (merchantIndex !== -1) {
                appState.merchants[merchantIndex].status = 'active';
                showNotification(`Merchant ${appState.merchants[merchantIndex].name} approved!`, 'success');
                populateMerchantList();
                populateBusinessList(); // Update dropdowns and lists that might use this merchant as a business
                populateBusinessSectors();
            }
        }

        /**
         * Deletes a merchant account and their associated deals.
         * @param {string} merchantId - The ID of the merchant to delete.
         */
        function deleteMerchantAccount(merchantId) {
            appState.merchants = appState.merchants.filter(m => m.id !== merchantId);
            // Also remove their deals
            appState.deals = appState.deals.filter(d => d.partnerId !== merchantId);
            showNotification('Merchant and associated deals deleted successfully!', 'success');
            populateMerchantList();
            populateDealManagementList('admin'); // Refresh admin deals list
            filterDeals('current'); // Refresh user deals view
            populateStatistics();
            populateBusinessList(); // Refresh business list as this merchant is a business
            populateBusinessSectors();
        }

        /**
         * Populates the merchant's own deal management list.
         */
        function populateMerchantDealManagementList() {
            populateDealManagementList('merchant');
        }

        /**
         * Updates the merchant's deal statistics section.
         */
        function updateMerchantDealStatistics() {
            if (!appState.currentUser || !appState.currentUser.isMerchant) {
                document.getElementById('merchant-deals-stats-list').innerHTML = '<p style="text-align: center; color: #888; padding: 20px;">Login as a merchant to view deal statistics.</p>';
                return;
            }

            const merchantDeals = appState.deals.filter(d => d.partnerId === appState.currentUser.id);
            const totalDealsOffered = merchantDeals.length;
            const totalRedemptions = merchantDeals.reduce((sum, deal) => sum + deal.redemptions, 0);
            const activeDealsCount = merchantDeals.filter(deal => deal.active && new Date(deal.expiry) >= new Date()).length;
            const averageRedemptions = totalDealsOffered > 0 ? (totalRedemptions / totalDealsOffered).toFixed(1) : 0;

            document.getElementById('total-deals-offered').textContent = totalDealsOffered;
            document.getElementById('total-deal-redemptions').textContent = totalRedemptions;
            document.getElementById('average-redemptions').textContent = averageRedemptions;
            document.getElementById('active-deals-count').textContent = activeDealsCount;

            const statsListDiv = document.getElementById('merchant-deals-stats-list');
            statsListDiv.innerHTML = '';

            if (merchantDeals.length === 0) {
                statsListDiv.innerHTML = '<p style="text-align: center; color: #888; padding: 20px;">You have no deals currently. Add some to see statistics!</p>';
                return;
            }

            merchantDeals.forEach(deal => {
                const dealStatItem = document.createElement('div');
                dealStatItem.className = 'deal-stat-card';
                dealStatItem.style.marginBottom = '10px';
                dealStatItem.innerHTML = `
                    <h4 style="font-size: 1.1rem; margin-bottom: 5px; color: var(--dark);">${deal.title}</h4>
                    <p style="font-size: 0.9em; color: #666;">Redemptions: <strong style="color: var(--primary);">${deal.redemptions}</strong></p>
                    <p style="font-size: 0.8em; color: #999;">Active: ${deal.active ? 'Yes' : 'No'} | Expires: ${new Date(deal.expiry).toLocaleDateString()}</p>
                `;
                statsListDiv.appendChild(dealStatItem);
            });
        }


        // --- Custom Confirmation Modal (replacing window.confirm) ---
        function showCustomConfirm(message, onConfirm) {
            const existingModal = document.getElementById('custom-confirm-modal');
            if (existingModal) existingModal.remove(); // Remove any existing modal

            const modal = document.createElement('div');
            modal.id = 'custom-confirm-modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <p>${message}</p>
                    <button id="confirm-yes" class="btn btn-danger">Yes</button>
                    <button id="confirm-no" class="btn btn-secondary">No</button>
                </div>
            `;
            document.body.appendChild(modal);

            document.getElementById('confirm-yes').onclick = () => {
                onConfirm();
                modal.remove();
            };
            document.getElementById('confirm-no').onclick = () => {
                modal.remove();
            };
        }

        // --- Event Listeners & Initializers ---

        document.addEventListener('DOMContentLoaded', function() {
            // Populate dynamic content initially
            populatePlanSelection();
            populateSocialRequirements();
            populateAdminSettingsForm(); // Populates terms and login image
            populateBusinessSectors();
            populateStatistics();
            populateSectorList();
            populateBusinessList();


            // Hide all pages initially except home
            document.querySelectorAll('.page').forEach(page => {
                page.style.display = 'none';
            });
            document.getElementById('home-page').style.display = 'block';
            document.getElementById('home-page').classList.add('active');

            // Navigation links
            document.querySelectorAll('nav a').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const pageId = this.getAttribute('data-page');
                    showPage(pageId);
                });
            });

            // Login tab switching (User Phone / User Email / Merchant Login)
            document.querySelectorAll('#home-page .tabs .btn').forEach(tab => {
                tab.addEventListener('click', function() {
                    switchTab(this, 'home');
                });
            });

            // Admin panel tab switching
            document.querySelectorAll('#admin-page .tabs .btn').forEach(tab => {
                tab.addEventListener('click', function() {
                    switchTab(this, 'admin');
                });
            });

            // Merchant panel tab switching
            document.querySelectorAll('#merchant-page .tabs .btn').forEach(tab => {
                tab.addEventListener('click', function() {
                    switchTab(this, 'merchant');
                });
            });


            // Login/Logout button functionality
            document.getElementById('login-btn').addEventListener('click', function() {
                showPage('home');
            });

            document.getElementById('logout-btn').addEventListener('click', function() {
                appState.currentUser = null;
                showNotification('Logged out successfully.', 'info');
                showPage('home'); // Go back to login page
            });

            // User phone login: Send OTP
            document.getElementById('send-user-otp').addEventListener('click', function() {
                const phoneInput = document.getElementById('user-phone');
                if (phoneInput.checkValidity()) {
                    document.getElementById('user-otp-section').style.display = 'block';
                    showNotification('OTP (123456) has been sent to your phone. Use 123456 to login.', 'info');
                } else {
                    showNotification('Please enter a valid phone number', 'error');
                }
            });

            // User phone login: Verify OTP (OTP inputs for login)
            document.querySelectorAll('#user-otp-section .otp-input').forEach((input, index, arr) => {
                input.addEventListener('input', () => {
                    if (input.value.length === 1 && index < arr.length - 1) {
                        arr[index + 1].focus();
                    }
                });
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Backspace' && input.value.length === 0 && index > 0) {
                        arr[index - 1].focus();
                    }
                });
            });

            // Verify user OTP (phone login)
            document.getElementById('user-login-verify-otp').addEventListener('click', function(e) {
                e.preventDefault();
                const otpInputs = Array.from(document.querySelectorAll('#user-otp-section .otp-input'));
                const enteredOtp = otpInputs.map(input => input.value).join('');

                if (enteredOtp === '123456') { // Hardcoded OTP for demo
                    const phone = document.getElementById('user-phone').value;
                    let existingUser = appState.users.find(u => u.phone === phone);

                    if (!existingUser) {
                        showNotification('No account found with this phone number. Please register.', 'error');
                        return;
                    }
                    if (existingUser.status !== 'active') {
                        showNotification(`Your account is ${existingUser.status}. Please await admin approval.`, 'warning');
                        return;
                    }

                    appState.currentUser = existingUser;

                    showNotification(`Welcome, ${appState.currentUser.fullName}! Login successful.`, 'success');
                    showPage('membership');
                } else {
                    showNotification('Invalid OTP. Please try again.', 'error');
                }
            });

            // User Email/Password login
            document.getElementById('email-login-form').addEventListener('submit', function(e) {
                e.preventDefault();

                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;

                // Admin credentials
                if (email === 'admin@example.com' && password === 'admin123') {
                    appState.currentUser = {
                        isAdmin: true,
                        fullName: "Admin User",
                        email: email
                    };
                    showNotification('Admin login successful!', 'success');
                    showPage('admin');
                    return; // Exit after admin login
                }

                // Regular user login by email
                const user = appState.users.find(u => u.email === email && u.password === password); // Mock check

                if (user) {
                    if (user.status !== 'active') {
                        showNotification(`Your account is ${user.status}. Please await admin approval.`, 'warning');
                        return;
                    }
                    appState.currentUser = user;
                    showNotification(`Welcome back, ${user.fullName}!`, 'success');
                    showPage('membership');
                } else {
                    showNotification('Invalid email or password', 'error');
                }
            });

            // Merchant Login
            document.getElementById('merchant-login-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const email = document.getElementById('merchant-email').value;
                const password = document.getElementById('merchant-password').value;

                const merchant = appState.merchants.find(m => m.email === email && m.password === password);
                if (merchant) {
                    if (merchant.status !== 'active') {
                        showNotification(`Your merchant account is ${merchant.status}. Please await admin approval.`, 'warning');
                        return;
                    }
                    appState.currentUser = { ...merchant, isMerchant: true }; // Add isMerchant flag
                    showNotification(`Welcome, Merchant ${merchant.name}! Login successful.`, 'success');
                    showPage('merchant');
                } else {
                    showNotification('Invalid merchant email or password.', 'error');
                }
            });

            // Show Registration from Login Page
            document.getElementById('show-register').addEventListener('click', function(e) {
                e.preventDefault();
                showPage('registration');
            });

            // Show Merchant Registration from Login Page
            document.getElementById('show-merchant-register').addEventListener('click', function(e) {
                e.preventDefault();
                showPage('merchant-registration');
            });

            // Switch to Merchant Login from Merchant Registration
            document.getElementById('switchToMerchantLogin').addEventListener('click', function(e) {
                e.preventDefault();
                showPage('home');
                switchTab(document.querySelector('#home-page .tabs .btn[data-tab="merchant-login"]'), 'home');
            });


            // Forgot password
            document.getElementById('forgot-password').addEventListener('click', function(e) {
                e.preventDefault();
                showNotification('Password reset instructions have been sent to your email (mock).', 'info');
            });

            // Registration form: Send OTP (for registration phone field)
            document.getElementById('send-reg-otp').addEventListener('click', function() {
                const phoneInput = document.getElementById('reg-phone');
                if (phoneInput.checkValidity()) {
                    document.getElementById('reg-otp-section').style.display = 'block';
                    showNotification('OTP (654321) has been sent to your mobile (mock).', 'info');
                } else {
                    showNotification('Please enter a valid mobile number for registration.', 'error');
                }
            });

            // Auto-focus and advance OTP inputs for registration form
            document.querySelectorAll('#reg-otp-section .reg-otp-input').forEach((input, index, arr) => {
                input.addEventListener('input', () => {
                    if (input.value.length === 1 && index < arr.length - 1) {
                        arr[index + 1].focus();
                    }
                });
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Backspace' && input.value.length === 0 && index > 0) {
                        arr[index - 1].focus();
                    }
                });
            });

            // Registration form submission
            document.getElementById('registration-form').addEventListener('submit', function(e) {
                e.preventDefault();

                const fullName = document.getElementById('full-name').value;
                const email = document.getElementById('reg-email').value;
                const password = document.getElementById('reg-password').value; // In real app, hash this!
                const phone = document.getElementById('reg-phone').value;
                const regOtpInputs = Array.from(document.querySelectorAll('#reg-otp-section .reg-otp-input'));
                const enteredRegOtp = regOtpInputs.map(input => input.value).join('');
                const address = document.getElementById('reg-address').value;
                const selectedPlanValue = document.getElementById('selected-plan').value;
                const profilePhotoFile = document.getElementById('profile-photo').files[0];

                if (document.getElementById('reg-otp-section').style.display === 'block' && enteredRegOtp !== '654321') {
                    showNotification('Invalid OTP for registration.', 'error');
                    return;
                }

                // Check if email or phone number already exists for users
                if (appState.users.some(u => u.email === email)) {
                    showNotification('A user with this email already exists. Please login instead.', 'error');
                    return;
                }
                if (appState.users.some(u => u.phone === phone)) {
                    showNotification('A user with this phone number already exists. Please login instead or use forgot password.', 'error');
                    return;
                }

                let socialLinksFollowed = true; // Mock check
                // In a real app, you'd integrate with social APIs to verify follows
                for (const socialKey in appState.adminSettings.socialRequirements) {
                    if (appState.adminSettings.socialRequirements[socialKey]) {
                        if (!appState.adminSettings.socialLinks[socialKey]) {
                            socialLinksFollowed = false;
                            showNotification(`Admin has not set a link for required social media: ${socialKey}. Cannot register.`, 'error');
                            break;
                        }
                    }
                }
                if (!socialLinksFollowed) {
                    showNotification('Please fulfill all social media requirements before registering.', 'error');
                    return;
                }

                const cardNumber = generateMemberId();
                const expiry = calculateExpiryDate();
                const status = (selectedPlanValue === 'free' && appState.adminSettings.autoApproveFree) ? 'active' : 'pending';

                let photoUrl = '';
                if (profilePhotoFile) {
                    // In a real app, upload this to a storage service (Firebase Storage, AWS S3)
                    // For demo, we can convert to base64 if needed, but it's not scalable for many images.
                    // Sticking with a placeholder here for simplicity.
                    photoUrl = URL.createObjectURL(profilePhotoFile);
                    showNotification('Profile photo uploaded (mock).', 'info');
                }

                const newUser = {
                    fullName,
                    email,
                    password,
                    phone,
                    address,
                    photoUrl: photoUrl,
                    plan: selectedPlanValue,
                    cardNumber,
                    expiry,
                    status,
                    isMerchant: false
                };
                appState.users.push(newUser); // Add new user to the global state
                appState.stats.cardHolders++; // Update statistics

                appState.currentUser = newUser; // Log in the new user

                if (selectedPlanValue !== 'free' && appState.adminSettings.showPlanSelection) {
                    document.getElementById('payment-section').style.display = 'block';
                    document.getElementById('registration-section').style.display = 'none';

                    document.getElementById('payment-plan-name').textContent = appState.adminSettings.plans[selectedPlanValue].name;
                    document.getElementById('payment-amount').textContent = `₵${appState.adminSettings.plans[selectedPlanValue].price}`;
                    showNotification('Please complete your payment to finalize registration.', 'info');
                } else {
                    showNotification('Registration successful! Your membership is active.', 'success');
                    showPage('membership');
                }
                populateMemberList(); // Update admin member list
            });

            // Merchant Registration form submission
            document.getElementById('merchant-registration-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const name = document.getElementById('merchant-name').value;
                const email = document.getElementById('merchant-reg-email').value;
                const password = document.getElementById('merchant-reg-password').value;
                const phone = document.getElementById('merchant-phone').value;
                const address = document.getElementById('merchant-address').value;
                const category = document.getElementById('merchant-category').value;
                const logo = document.getElementById('merchant-logo-url').value;

                if (appState.merchants.some(m => m.email === email)) {
                    showNotification('A merchant with this email already exists.', 'error');
                    return;
                }
                if (appState.merchants.some(m => m.name === name)) {
                    showNotification('A merchant with this business name already exists.', 'error');
                    return;
                }

                const newMerchant = {
                    id: 'm' + Date.now(),
                    name, email, password, phone, address, category, logo,
                    status: 'pending' // Merchants need admin approval
                };
                appState.merchants.push(newMerchant);
                appState.stats.businesses++; // Update total businesses stat

                // Also add to the general businesses list for display
                const sectorId = appState.sectors.find(s => s.name === category)?.id || 's-other';
                if (!appState.sectors.some(s => s.id === sectorId)) { // Add generic sector if not exists
                    appState.sectors.push({ id: sectorId, name: category });
                    populateSectorList();
                }
                appState.businesses.push({ id: newMerchant.id, name: newMerchant.name, sector: sectorId, logo: newMerchant.logo });

                showNotification('Merchant registration submitted! Awaiting admin approval.', 'success');
                showPage('home');
                populateMerchantList(); // Refresh admin merchant list
                populateBusinessList(); // Refresh admin business list
                populateBusinessSectors(); // Refresh home page business display
                populateStatistics(); // Refresh stats
            });


            // Payment method selection
            document.querySelectorAll('.payment-method').forEach(method => {
                method.addEventListener('click', function() {
                    document.querySelectorAll('.payment-method').forEach(m => {
                        m.classList.remove('selected');
                    });
                    this.classList.add('selected');

                    const methodType = this.getAttribute('data-method');
                    document.getElementById('momo-details').style.display = 'none';
                    document.getElementById('cash-details').style.display = 'none';
                    document.getElementById('bank-details').style.display = 'none';

                    if (methodType === 'momo') {
                        document.getElementById('momo-details').style.display = 'block';
                    } else if (methodType === 'cash') {
                        document.getElementById('cash-details').style.display = 'block';
                    } else if (methodType === 'bank') {
                        document.getElementById('bank-details').style.display = 'block';
                    }
                });
            });

            // Complete payment
            document.getElementById('complete-payment-btn').addEventListener('click', function() {
                if (!document.querySelector('.payment-method.selected')) {
                    showNotification('Please select a payment method.', 'error');
                    return;
                }
                if (appState.currentUser) {
                    // For demo, we just assume payment is successful.
                    // In a real app, this would involve processing payment and waiting for confirmation.
                    appState.currentUser.status = 'active'; // Mark as active after mock payment
                    showNotification('Payment confirmed! Your membership is now active.', 'success');
                    showPage('membership');
                    populateMemberList(); // Update admin member list status
                } else {
                    showNotification('Error: No active user to confirm payment for.', 'error');
                }
            });

            // Download Card functionality (mock)
            document.getElementById('download-card-btn').addEventListener('click', function() {
                showNotification('Card download initiated. (Feature under development, please screenshot for now)', 'info');
                // In a real app, you'd use html2canvas or similar to convert the card div to an image and download it.
            });

            // Share via WhatsApp (mock)
            document.getElementById('share-card-btn').addEventListener('click', function() {
                if (appState.currentUser) {
                    const message = `Check out my new Indians in Ghana Membership Card! My ID is ${appState.currentUser.cardNumber}. Join the community: https://indiansinghana.com`; // Changed link to generic
                    const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
                    window.open(whatsappUrl, '_blank');
                    showNotification('Sharing via WhatsApp...', 'info');
                } else {
                    showNotification('Please login to share your card.', 'error');
                }
            });

            // Save Admin Settings
            document.getElementById('save-admin-settings').addEventListener('click', function() {
                // Update social requirements
                appState.adminSettings.socialRequirements.facebook = document.getElementById('req-facebook').checked;
                appState.adminSettings.socialRequirements.instagram = document.getElementById('req-instagram').checked;
                appState.adminSettings.socialRequirements.youtube = document.getElementById('req-youtube').checked;
                appState.adminSettings.socialRequirements.whatsappChannel = document.getElementById('req-whatsapp-channel').checked;
                appState.adminSettings.socialRequirements.whatsappGroup = document.getElementById('req-whatsapp-group').checked;

                // Update social links
                appState.adminSettings.socialLinks.facebook = document.getElementById('facebook-link').value;
                appState.adminSettings.socialLinks.instagram = document.getElementById('instagram-link').value;
                appState.adminSettings.socialLinks.youtube = document.getElementById('youtube-link').value;
                appState.adminSettings.socialLinks.whatsappChannel = document.getElementById('whatsapp-channel-link').value;
                appState.adminSettings.socialLinks.whatsappGroup = document.getElementById('whatsapp-group-link').value;

                // Update plan selection visibility
                appState.adminSettings.showPlanSelection = document.getElementById('show-plan-selection').checked;

                // Update card layout
                appState.adminSettings.cardLayout = document.getElementById('card-layout-select').value;

                // Update plan names and prices
                appState.adminSettings.plans.free.name = document.getElementById('free-plan-name').value;
                appState.adminSettings.plans.free.features = document.getElementById('free-plan-features').value.split(',').map(f => f.trim());

                appState.adminSettings.plans.basic.name = document.getElementById('basic-plan-name').value;
                appState.adminSettings.plans.basic.price = parseFloat(document.getElementById('basic-plan-price').value);
                appState.adminSettings.plans.basic.features = document.getElementById('basic-plan-features').value.split(',').map(f => f.trim());

                appState.adminSettings.plans.premium.name = document.getElementById('premium-plan-name').value;
                appState.adminSettings.plans.premium.price = parseFloat(document.getElementById('premium-plan-price').value);
                appState.adminSettings.plans.premium.features = document.getElementById('premium-plan-features').value.split(',').map(f => f.trim());

                // Update system settings
                appState.adminSettings.systemName = document.getElementById('system-name').value;
                appState.adminSettings.adminNotificationEmail = document.getElementById('admin-notification-email').value;
                appState.adminSettings.cardExpiryPeriod = parseInt(document.getElementById('card-expiry-period').value);
                appState.adminSettings.autoApproveFree = document.getElementById('auto-approve-free').checked;
                appState.adminSettings.loginImage = document.getElementById('login-image-url').value;
                appState.adminSettings.termsConditions = document.getElementById('terms-conditions').value;
                appState.adminSettings.showStats = document.getElementById('show-stats').checked;

                // Refresh UI elements impacted by settings
                if (document.getElementById('login-image')) document.getElementById('login-image').src = appState.adminSettings.loginImage;
                if (document.getElementById('terms-container')) document.getElementById('terms-container').innerHTML = appState.adminSettings.termsConditions;
                populateStatistics(); // Update stats visibility based on setting
                populatePlanSelection(); // Refresh plan dropdown in registration
                populateSocialRequirements(); // Refresh social links in registration
                updateMembershipCardDisplay(); // Update card if current user is active
                showNotification('Admin settings saved successfully!', 'success');
            });

            // Admin: Add New Deal button
            document.getElementById('admin-add-new-deal-btn').addEventListener('click', function() {
                document.getElementById('admin-deal-form-title').innerHTML = '<i class="fas fa-edit"></i> Add New Deal (Admin)';
                document.getElementById('admin-add-edit-deal-form').style.display = 'block';
                // Clear form fields for new deal
                document.getElementById('admin-deal-title').value = '';
                document.getElementById('admin-deal-description').value = '';
                document.getElementById('admin-deal-partner').value = '';
                document.getElementById('admin-new-partner-name').value = '';
                document.getElementById('admin-deal-category').value = '';
                document.getElementById('admin-deal-expiry-date').valueAsDate = new Date(); // Default to today
                document.getElementById('admin-deal-active').checked = true;
                document.getElementById('admin-deal-plan-free').checked = false;
                document.getElementById('admin-deal-plan-basic').checked = false;
                document.getElementById('admin-deal-plan-premium').checked = false;
                delete document.getElementById('admin-save-deal-btn').dataset.dealId; // Remove ID for new deal
            });

            // Admin: Save Deal button
            document.getElementById('admin-save-deal-btn').addEventListener('click', function(e) {
                e.preventDefault();
                saveDeal('admin');
            });

            // Admin: Cancel Deal button
            document.getElementById('admin-cancel-deal-btn').addEventListener('click', function() {
                document.getElementById('admin-add-edit-deal-form').style.display = 'none';
            });

            // Merchant: Add New Deal button
            document.getElementById('add-new-merchant-deal-btn').addEventListener('click', function() {
                document.getElementById('merchant-deal-form-title').innerHTML = '<i class="fas fa-edit"></i> Add New Deal';
                document.getElementById('add-edit-merchant-deal-form').style.display = 'block';
                // Clear form fields for new deal
                document.getElementById('merchant-deal-title').value = '';
                document.getElementById('merchant-deal-description').value = '';
                document.getElementById('merchant-deal-category').value = '';
                document.getElementById('merchant-deal-expiry-date').valueAsDate = new Date(); // Default to today
                document.getElementById('merchant-deal-active').checked = true;
                document.getElementById('merchant-deal-plan-free').checked = false;
                document.getElementById('merchant-deal-plan-basic').checked = false;
                document.getElementById('merchant-deal-plan-premium').checked = false;
                delete document.getElementById('save-merchant-deal-btn').dataset.dealId; // Remove ID for new deal
            });

            // Merchant: Save Deal button
            document.getElementById('save-merchant-deal-btn').addEventListener('click', function(e) {
                e.preventDefault();
                saveDeal('merchant');
            });

            // Merchant: Cancel Deal button
            document.getElementById('cancel-merchant-deal-btn').addEventListener('click', function() {
                document.getElementById('add-edit-merchant-deal-form').style.display = 'none';
            });


            // Add Sector button
            document.getElementById('add-sector-btn').addEventListener('click', function() {
                const newSectorInput = document.getElementById('new-sector');
                const sectorName = newSectorInput.value.trim();
                if (!sectorName) {
                    showNotification('Please enter a sector name', 'error');
                    return;
                }

                const newSector = {
                    id: 's' + Date.now(), // Simple unique ID
                    name: sectorName
                };

                appState.sectors.push(newSector);
                showNotification('Sector added successfully!', 'success');
                populateSectorList();
                populateBusinessList(); // Refresh business sector dropdown
                populateBusinessSectors(); // Refresh login page display
                newSectorInput.value = ''; // Clear input
            });

            // Delete Sector button (delegated event listener)
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('delete-sector-btn')) {
                    const sectorId = e.target.dataset.sectorId;
                    showCustomConfirm('Are you sure you want to delete this sector? All associated businesses will be unassigned.', () => {
                        appState.sectors = appState.sectors.filter(s => s.id !== sectorId);
                        // Unassign businesses from this sector (set sector to empty string)
                        appState.businesses.forEach(b => {
                            if (b.sector === sectorId) b.sector = '';
                        });
                        showNotification('Sector deleted successfully!', 'success');
                        populateSectorList();
                        populateBusinessList();
                        populateBusinessSectors();
                    });
                }
            });

            // Add Business button
            document.getElementById('add-business-btn').addEventListener('click', function() {
                const businessNameInput = document.getElementById('business-name');
                const businessSectorSelect = document.getElementById('business-sector');
                const businessLogoInput = document.getElementById('business-logo');

                const name = businessNameInput.value.trim();
                const sector = businessSectorSelect.value;
                const logo = businessLogoInput.value.trim();

                if (!name) {
                    showNotification('Business name is required', 'error');
                    return;
                }
                if (!sector) {
                    showNotification('Please select a sector for the business.', 'error');
                    return;
                }

                const newBusiness = {
                    id: 'b' + Date.now(), // Simple unique ID
                    name,
                    sector,
                    logo
                };

                appState.businesses.push(newBusiness);
                appState.stats.businesses++; // Update statistics
                showNotification('Business added successfully!', 'success');
                populateBusinessList();
                populateBusinessSectors();
                populateStatistics();

                // Clear form
                businessNameInput.value = '';
                businessLogoInput.value = '';
                // No need to reset sectorSelect, it'll default to first option
            });

            // Delete Business button (delegated event listener)
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('delete-business-btn')) {
                    const businessId = e.target.dataset.businessId;
                    showCustomConfirm('Are you sure you want to delete this business?', () => {
                        appState.businesses = appState.businesses.filter(b => b.id !== businessId);
                        appState.stats.businesses--; // Update statistics
                        showNotification('Business deleted successfully!', 'success');
                        populateBusinessList();
                        populateBusinessSectors();
                        populateStatistics();
                    });
                }
            });

            // Deals tab filtering (for members)
            document.querySelectorAll('.deals-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.deals-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    filterDeals(this.getAttribute('data-deal-filter'));
                });
            });

            // Mark deal as used (delegated event listener)
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('used-btn')) {
                    const dealId = e.target.dataset.dealId;
                    const partnerId = e.target.dataset.partnerId;

                    const deal = appState.deals.find(d => d.id === dealId);
                    if (deal) {
                        deal.redemptions = (deal.redemptions || 0) + 1;
                        appState.stats.dealsUsed++; // Update global stat
                        showNotification('Deal marked as used. Thank you for your feedback!', 'success');
                        populateStatistics(); // Update global stats display
                        // Optional: Refresh merchant stats if they are currently logged in and viewing their stats
                        if (appState.currentUser && appState.currentUser.isMerchant && appState.currentUser.id === partnerId) {
                            updateMerchantDealStatistics();
                        }
                    }
                }
            });

            // Save User Settings
            document.getElementById('save-user-settings').addEventListener('click', function(e) {
                e.preventDefault();
                if (appState.currentUser && !appState.currentUser.isAdmin && !appState.currentUser.isMerchant) {
                    const newFullName = document.getElementById('setting-full-name').value.trim();
                    const newEmail = document.getElementById('setting-email').value.trim();
                    const newAddress = document.getElementById('setting-address').value.trim();
                    const currentPassword = document.getElementById('current-password').value;
                    const newPassword = document.getElementById('new-password').value;
                    const confirmPassword = document.getElementById('confirm-password').value;
                    const profilePhotoFile = document.getElementById('setting-profile-photo').files[0];

                    if (newPassword) {
                        // In a real app, you'd validate current password against stored hash
                        // and then hash and save new password.
                        if (!currentPassword) {
                            showNotification('Please enter your current password to change it.', 'error');
                            return;
                        }
                        if (newPassword !== confirmPassword) {
                            showNotification('New password and confirm password do not match.', 'error');
                            return;
                        }
                        // Mock password update
                        appState.currentUser.password = newPassword;
                        showNotification('Password updated successfully (mock).', 'success');
                    }

                    // Update user details
                    appState.currentUser.fullName = newFullName;
                    appState.currentUser.email = newEmail;
                    appState.currentUser.address = newAddress;

                    if (profilePhotoFile) {
                        // In a real app, upload this to a storage service
                        // For demo, we can convert to base64 or createObjectURL
                        appState.currentUser.photoUrl = URL.createObjectURL(profilePhotoFile);
                        showNotification('New profile photo uploaded (mock).', 'info');
                    }

                    // Find the user in the main users array and update them
                    const userIndex = appState.users.findIndex(u => u.cardNumber === appState.currentUser.cardNumber);
                    if (userIndex !== -1) {
                        appState.users[userIndex] = { ...appState.currentUser }; // Update the master list
                    }

                    showNotification('User settings saved successfully!', 'success');
                    updateMembershipCardDisplay(); // Refresh card display with new name/photo if needed
                    populateMemberList(); // Refresh admin list with updated name
                    // Clear password fields after save
                    document.getElementById('current-password').value = '';
                    document.getElementById('new-password').value = '';
                    document.getElementById('confirm-password').value = '';
                    document.getElementById('setting-profile-photo').value = ''; // Clear file input
                } else {
                    showNotification('Please login as a user to update settings.', 'error');
                }
            });

            // Delete Account button (User settings)
            document.getElementById('delete-account-btn').addEventListener('click', function() {
                if (appState.currentUser && !appState.currentUser.isAdmin && !appState.currentUser.isMerchant) {
                    showCustomConfirm('Are you sure you want to delete your account? This action cannot be undone.', () => {
                        appState.users = appState.users.filter(u => u.cardNumber !== appState.currentUser.cardNumber);
                        appState.stats.cardHolders--; // Update statistics
                        appState.currentUser = null;
                        showNotification('Your account has been deleted.', 'success');
                        showPage('home');
                        populateMemberList(); // Refresh admin list
                        populateStatistics(); // Refresh stats
                    });
                } else {
                    showNotification('Please login as a user to delete your account.', 'error');
                }
            });

            // Contact Form Submission
            document.getElementById('contactForm').addEventListener('submit', function(e) {
                e.preventDefault();
                showNotification('Thank you for your message! We will contact you soon.', 'success');
                this.reset();
            });
        });
    </script>
</body>
</html>
