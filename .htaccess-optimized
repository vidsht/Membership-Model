# Indians in Ghana Membership System - Optimized .htaccess
# Compatible with the cache busting system

<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /
  
  # Handle React Router (keep existing)
  RewriteRule ^index\.html$ - [L]
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule . /index.html [L]
</IfModule>

# Optimized Cache Control Headers
<IfModule mod_headers.c>
  # HTML files - Short cache with revalidation (for SPA updates)
  <FilesMatch "\.(html)$">
    Header set Cache-Control "public, max-age=300, must-revalidate"
    Header set X-Content-Type-Options "nosniff"
  </FilesMatch>

  # JavaScript and CSS - Medium cache with cache busting support
  <FilesMatch "\.(js|css)$">
    Header set Cache-Control "public, max-age=3600, must-revalidate"
    Header set X-Content-Type-Options "nosniff"
  </FilesMatch>

  # Images - Longer cache with stale-while-revalidate
  <FilesMatch "\.(jpg|jpeg|png|gif|webp|svg|ico|avif)$">
    Header set Cache-Control "public, max-age=86400, stale-while-revalidate=3600"
  </FilesMatch>

  # Fonts - Very long cache (rarely change)
  <FilesMatch "\.(woff|woff2|ttf|eot|otf)$">
    Header set Cache-Control "public, max-age=2592000, immutable"
    Header set Access-Control-Allow-Origin "*"
  </FilesMatch>

  # API responses - Short cache (if you serve API from same domain)
  <FilesMatch "\.json$">
    Header set Cache-Control "public, max-age=300, must-revalidate"
    Header set X-Content-Type-Options "nosniff"
  </FilesMatch>

  # Security headers for all files
  Header always set X-Frame-Options "SAMEORIGIN"
  Header always set X-XSS-Protection "1; mode=block"
  Header always set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# Compression for better performance
<IfModule mod_deflate.c>
  # Compress HTML, CSS, JavaScript, Text, XML and fonts
  AddOutputFilterByType DEFLATE application/javascript
  AddOutputFilterByType DEFLATE application/rss+xml
  AddOutputFilterByType DEFLATE application/vnd.ms-fontobject
  AddOutputFilterByType DEFLATE application/x-font
  AddOutputFilterByType DEFLATE application/x-font-opentype
  AddOutputFilterByType DEFLATE application/x-font-otf
  AddOutputFilterByType DEFLATE application/x-font-truetype
  AddOutputFilterByType DEFLATE application/x-font-ttf
  AddOutputFilterByType DEFLATE application/x-javascript
  AddOutputFilterByType DEFLATE application/xhtml+xml
  AddOutputFilterByType DEFLATE application/xml
  AddOutputFilterByType DEFLATE font/opentype
  AddOutputFilterByType DEFLATE font/otf
  AddOutputFilterByType DEFLATE font/ttf
  AddOutputFilterByType DEFLATE image/svg+xml
  AddOutputFilterByType DEFLATE image/x-icon
  AddOutputFilterByType DEFLATE text/css
  AddOutputFilterByType DEFLATE text/html
  AddOutputFilterByType DEFLATE text/javascript
  AddOutputFilterByType DEFLATE text/plain
  AddOutputFilterByType DEFLATE text/xml
</IfModule>

# ETags for cache validation (works with our cache busting)
<IfModule mod_headers.c>
  Header unset ETag
</IfModule>
FileETag None

# Browser compatibility and security
<IfModule mod_headers.c>
  # Remove server signature
  Header unset Server
  Header unset X-Powered-By
  
  # Force HTTPS (if using SSL)
  # Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
  
  # Content Security Policy (customize as needed)
  # Header set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline';"
</IfModule>

# Prevent access to sensitive files
<FilesMatch "\.(env|log|htaccess|htpasswd|ini|conf|bak)$">
  Order Allow,Deny
  Deny from all
</FilesMatch>